name: Weekly Summary

on:
  schedule:
    # 매주 일요일 한국 시간 오전 10시에 실행 (UTC 1시)
    - cron: '0 1 * * 0'
  workflow_dispatch: # 수동으로도 실행 가능

jobs:
  weekly-summary:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Git
        run: |
          git config --local user.email "neolove0125@gmail.com"
          git config --local user.name "Energy System Bot"

      - name: Create weekly summary
        run: |
          # 주간 요약 파일 생성
          echo "# 📊 Weekly Activity Summary" > weekly_summary.md
          echo "" >> weekly_summary.md
          echo "## 📅 Week of $(date '+%Y-%m-%d')" >> weekly_summary.md
          echo "" >> weekly_summary.md
          
          # 일일 활동 로그가 있다면 요약
          if [ -f daily_activity.log ]; then
            echo "## 🌱 Daily Activities" >> weekly_summary.md
            echo "" >> weekly_summary.md
            echo "이번 주 활동 내역:" >> weekly_summary.md
            echo "" >> weekly_summary.md
            echo '```' >> weekly_summary.md
            tail -7 daily_activity.log >> weekly_summary.md
            echo '```' >> weekly_summary.md
            echo "" >> weekly_summary.md
          fi
          
          # 프로젝트 통계
          echo "## 📈 Project Statistics" >> weekly_summary.md
          echo "" >> weekly_summary.md
          echo "- **Total Files**: $(find . -name "*.py" -o -name "*.md" -o -name "*.html" -o -name "*.js" -o -name "*.css" | wc -l)" >> weekly_summary.md
          echo "- **Python Files**: $(find . -name "*.py" | wc -l)" >> weekly_summary.md
          echo "- **Documentation**: $(find . -name "*.md" | wc -l)" >> weekly_summary.md
          echo "- **Web Files**: $(find . -name "*.html" -o -name "*.js" -o -name "*.css" | wc -l)" >> weekly_summary.md
          echo "" >> weekly_summary.md
          
          # 다음 주 목표
          echo "## 🎯 Next Week Goals" >> weekly_summary.md
          echo "" >> weekly_summary.md
          goals=(
            "코드 품질 개선"
            "테스트 커버리지 향상"
            "문서 업데이트"
            "성능 최적화"
            "새로운 기능 개발"
            "버그 수정"
            "코드 리팩토링"
            "보안 강화"
          )
          
          for i in {1..3}; do
            random_goal=${goals[$RANDOM % ${#goals[@]}]}
            echo "- [ ] $random_goal" >> weekly_summary.md
          done
          
          echo "" >> weekly_summary.md
          echo "---" >> weekly_summary.md
          echo "*이 요약은 GitHub Actions에 의해 자동 생성되었습니다.*" >> weekly_summary.md

      - name: Commit weekly summary
        run: |
          git add weekly_summary.md
          git commit -m "📊 Weekly summary: $(date '+%Y-%m-%d')"
          git push

      - name: Show summary info
        run: |
          echo "✅ Weekly summary completed!"
          echo "📅 Date: $(date)"
          echo "📊 Summary file created"
