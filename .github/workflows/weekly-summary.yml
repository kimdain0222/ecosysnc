name: Weekly Summary

on:
  schedule:
    # ë§¤ì£¼ ì¼ìš”ì¼ í•œêµ­ ì‹œê°„ ì˜¤ì „ 10ì‹œì— ì‹¤í–‰ (UTC 1ì‹œ)
    - cron: '0 1 * * 0'
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œë„ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  weekly-summary:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Git
        run: |
          git config --local user.email "neolove0125@gmail.com"
          git config --local user.name "Energy System Bot"

      - name: Create weekly summary
        run: |
          # ì£¼ê°„ ìš”ì•½ íŒŒì¼ ìƒì„±
          echo "# ğŸ“Š Weekly Activity Summary" > weekly_summary.md
          echo "" >> weekly_summary.md
          echo "## ğŸ“… Week of $(date '+%Y-%m-%d')" >> weekly_summary.md
          echo "" >> weekly_summary.md
          
          # ì¼ì¼ í™œë™ ë¡œê·¸ê°€ ìˆë‹¤ë©´ ìš”ì•½
          if [ -f daily_activity.log ]; then
            echo "## ğŸŒ± Daily Activities" >> weekly_summary.md
            echo "" >> weekly_summary.md
            echo "ì´ë²ˆ ì£¼ í™œë™ ë‚´ì—­:" >> weekly_summary.md
            echo "" >> weekly_summary.md
            echo '```' >> weekly_summary.md
            tail -7 daily_activity.log >> weekly_summary.md
            echo '```' >> weekly_summary.md
            echo "" >> weekly_summary.md
          fi
          
          # í”„ë¡œì íŠ¸ í†µê³„
          echo "## ğŸ“ˆ Project Statistics" >> weekly_summary.md
          echo "" >> weekly_summary.md
          echo "- **Total Files**: $(find . -name "*.py" -o -name "*.md" -o -name "*.html" -o -name "*.js" -o -name "*.css" | wc -l)" >> weekly_summary.md
          echo "- **Python Files**: $(find . -name "*.py" | wc -l)" >> weekly_summary.md
          echo "- **Documentation**: $(find . -name "*.md" | wc -l)" >> weekly_summary.md
          echo "- **Web Files**: $(find . -name "*.html" -o -name "*.js" -o -name "*.css" | wc -l)" >> weekly_summary.md
          echo "" >> weekly_summary.md
          
          # ë‹¤ìŒ ì£¼ ëª©í‘œ
          echo "## ğŸ¯ Next Week Goals" >> weekly_summary.md
          echo "" >> weekly_summary.md
          goals=(
            "ì½”ë“œ í’ˆì§ˆ ê°œì„ "
            "í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í–¥ìƒ"
            "ë¬¸ì„œ ì—…ë°ì´íŠ¸"
            "ì„±ëŠ¥ ìµœì í™”"
            "ìƒˆë¡œìš´ ê¸°ëŠ¥ ê°œë°œ"
            "ë²„ê·¸ ìˆ˜ì •"
            "ì½”ë“œ ë¦¬íŒ©í† ë§"
            "ë³´ì•ˆ ê°•í™”"
          )
          
          for i in {1..3}; do
            random_goal=${goals[$RANDOM % ${#goals[@]}]}
            echo "- [ ] $random_goal" >> weekly_summary.md
          done
          
          echo "" >> weekly_summary.md
          echo "---" >> weekly_summary.md
          echo "*ì´ ìš”ì•½ì€ GitHub Actionsì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*" >> weekly_summary.md

      - name: Commit weekly summary
        run: |
          git add weekly_summary.md
          git commit -m "ğŸ“Š Weekly summary: $(date '+%Y-%m-%d')"
          git push

      - name: Show summary info
        run: |
          echo "âœ… Weekly summary completed!"
          echo "ğŸ“… Date: $(date)"
          echo "ğŸ“Š Summary file created"
