{% extends "base.html" %}

{% block title %}Ïã§ÏãúÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú - Ïä§ÎßàÌä∏ ÎπåÎî© ÏóêÎÑàÏßÄ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0">
                    <i class="fas fa-tachometer-alt text-primary me-2"></i>
                    Ïã§ÏãúÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú
                </h1>
                <div class="d-flex align-items-center">
                    <span class="real-time-indicator"></span>
                    <span class="text-muted">Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card stat-card text-center">
                <div class="card-body">
                    <i class="fas fa-building mb-2" style="font-size: 2rem;"></i>
                    <h4 class="card-title" id="total-buildings">{{ stats.total_buildings }}</h4>
                    <p class="card-text mb-0">Í¥ÄÎ¶¨ Í±¥Î¨º Ïàò</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card success text-center">
                <div class="card-body">
                    <i class="fas fa-bolt mb-2" style="font-size: 2rem;"></i>
                    <h4 class="card-title" id="current-power">{{ "%.1f"|format(stats.avg_power) }} kWh</h4>
                    <p class="card-text mb-0">ÌòÑÏû¨ Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ (kWh)</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card warning text-center">
                <div class="card-body">
                    <i class="fas fa-thermometer-half mb-2" style="font-size: 2rem;"></i>
                    <h4 class="card-title" id="current-temp">--</h4>
                    <p class="card-text mb-0">ÌòÑÏû¨ Ïò®ÎèÑ (¬∞C)</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card danger text-center">
                <div class="card-body">
                    <i class="fas fa-users mb-2" style="font-size: 2rem;"></i>
                    <h4 class="card-title" id="current-occupancy">--</h4>
                    <p class="card-text mb-0">ÌòÑÏû¨ Í≥µÏã§Î•† (%)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Building Overview -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-building me-2"></i>
                        Í±¥Î¨ºÎ≥Ñ Ïã§ÏãúÍ∞Ñ ÌòÑÌô©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- B001 - Î≥∏ÏÇ¨ Í±¥Î¨º -->
                        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                            <div class="building-card" data-building="B001">
                                <div class="building-header">
                                    <h6 class="building-title">üè¢ Î≥∏ÏÇ¨ Í±¥Î¨º</h6>
                                    <span class="building-status success">Ï†ïÏÉÅ</span>
                                </div>
                                <div class="building-floors">
                                    <div class="floor-item" data-floor="1">
                                        <span class="floor-name">1Ï∏µ Î°úÎπÑ</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">22¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">45 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="2">
                                        <span class="floor-name">2Ï∏µ ÏÇ¨Î¨¥Ïã§</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">24¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-danger fw-bold">78 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="3">
                                        <span class="floor-name">3Ï∏µ ÌöåÏùòÏã§</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">23¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">35 kWh</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- B002 - Ïó∞Íµ¨ÏÜå -->
                        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                            <div class="building-card" data-building="B002">
                                <div class="building-header">
                                    <h6 class="building-title">üî¨ Ïó∞Íµ¨ÏÜå</h6>
                                    <span class="building-status success">Ï†ïÏÉÅ</span>
                                </div>
                                <div class="building-floors">
                                    <div class="floor-item" data-floor="1">
                                        <span class="floor-name">1Ï∏µ Ï∂úÏûÖÍµ¨</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">21¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">28 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="2">
                                        <span class="floor-name">2Ï∏µ Ïã§ÌóòÏã§</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">22¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-danger fw-bold">65 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="3">
                                        <span class="floor-name">3Ï∏µ ÌÅ¥Î¶∞Î£∏</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">20¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">42 kWh</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- B003 - ÏÉùÏÇ∞Í≥µÏû• -->
                        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                            <div class="building-card" data-building="B003">
                                <div class="building-header">
                                    <h6 class="building-title">üè≠ ÏÉùÏÇ∞Í≥µÏû•</h6>
                                    <span class="building-status warning">Ï£ºÏùò</span>
                                </div>
                                <div class="building-floors">
                                    <div class="floor-item" data-floor="1">
                                        <span class="floor-name">1Ï∏µ Ï∞ΩÍ≥†</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">18¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">55 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="2">
                                        <span class="floor-name">2Ï∏µ ÏÉùÏÇ∞ÎùºÏù∏</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">25¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-danger fw-bold">120 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="3">
                                        <span class="floor-name">3Ï∏µ ÌíàÏßàÍ¥ÄÎ¶¨</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">23¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-danger fw-bold">68 kWh</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- B004 - Ï∞ΩÍ≥† -->
                        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                            <div class="building-card" data-building="B004">
                                <div class="building-header">
                                    <h6 class="building-title">üì¶ Ï∞ΩÍ≥†</h6>
                                    <span class="building-status success">Ï†ïÏÉÅ</span>
                                </div>
                                <div class="building-floors">
                                    <div class="floor-item" data-floor="1">
                                        <span class="floor-name">1Ï∏µ Î≥¥Í¥ÄÍµ¨Ïó≠</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">16¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">25 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="2">
                                        <span class="floor-name">2Ï∏µ ÎÉâÏû•Î≥¥Í¥Ä</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">4¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-danger fw-bold">85 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="3">
                                        <span class="floor-name">3Ï∏µ ÌïòÏó≠Ïû•</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">15¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">40 kWh</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- B005 - ÏÇ¨Î¨¥Ïã§ -->
                        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                            <div class="building-card" data-building="B005">
                                <div class="building-header">
                                    <h6 class="building-title">üè¢ ÏÇ¨Î¨¥Ïã§</h6>
                                    <span class="building-status success">Ï†ïÏÉÅ</span>
                                </div>
                                <div class="building-floors">
                                    <div class="floor-item" data-floor="1">
                                        <span class="floor-name">1Ï∏µ Ï†ëÏàòÏ≤ò</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">23¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">42 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="2">
                                        <span class="floor-name">2Ï∏µ Ïò§ÌîàÏò§ÌîºÏä§</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">24¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-danger fw-bold">95 kWh</span></small>
                                        </div>
                                    </div>
                                    <div class="floor-item" data-floor="3">
                                        <span class="floor-name">3Ï∏µ ÌöåÏùòÏã§</span>
                                        <div class="floor-stats">
                                            <small class="text-muted">Ïò®ÎèÑ: <span class="temp-value">22¬∞C</span></small>
                                            <small class="text-muted">Ï†ÑÎ†•: <span class="power-value text-warning fw-bold">58 kWh</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <!-- Real-time Power Consumption -->
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-line text-primary me-2"></i>
                        Ïã§ÏãúÍ∞Ñ Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="powerChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Environmental Data -->
        <div class="col-lg-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-leaf text-success me-2"></i>
                        ÌôòÍ≤Ω Îç∞Ïù¥ÌÑ∞
                    </h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="envChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Charts -->
    <div class="row mb-4">
        <!-- Hourly Pattern -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-clock text-warning me-2"></i>
                        ÏãúÍ∞ÑÎåÄÎ≥Ñ Ï†ÑÎ†• ÏÇ¨Ïö© Ìå®ÌÑ¥
                    </h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="hourlyChart"></canvas>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-circle text-info me-1"></i>Ïã¨ÏïºÏãúÍ∞Ñ (22-06Ïãú) |
                            <i class="fas fa-circle text-success me-1"></i>Ï∂úÌá¥Í∑º ÏãúÍ∞ÑÎåÄ (06-08Ïãú, 18-22Ïãú) |
                            <i class="fas fa-circle text-warning me-1"></i>ÏóÖÎ¨¥ÏãúÍ∞Ñ (08-18Ïãú)
                        </small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Building Comparison -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-building text-info me-2"></i>
                        Í±¥Î¨ºÎ≥Ñ Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ ÎπÑÍµê
                    </h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="buildingChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Latest Data Table -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-table text-secondary me-2"></i>
                        ÏµúÍ∑º Îç∞Ïù¥ÌÑ∞
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ÏãúÍ∞Ñ</th>
                                    <th>Í±¥Î¨º</th>
                                    <th>Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ (kWh)</th>
                                    <th>Ïò®ÎèÑ (¬∞C)</th>
                                    <th>ÏäµÎèÑ (%)</th>
                                    <th>Í≥µÏã§Î•† (%)</th>
                                    <th>ÏÉÅÌÉú</th>
                                </tr>
                            </thead>
                            <tbody id="data-table">
                                <!-- Îç∞Ïù¥ÌÑ∞Í∞Ä JavaScriptÎ°ú ÎèôÏ†Å Î°úÎìúÎê® -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let powerChart, envChart, hourlyChart, buildingChart;

$(document).ready(function() {
    initializeCharts();
    loadRealTimeData();
    
    // 10Ï¥àÎßàÎã§ Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
    setInterval(loadRealTimeData, 10000);
});

function initializeCharts() {
    // Ïã§ÏãúÍ∞Ñ Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ Ï∞®Ìä∏
    const powerCtx = document.getElementById('powerChart').getContext('2d');
    powerChart = new Chart(powerCtx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ (kWh)',
                data: [],
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ (kWh)'
                    }
                }
            }
        }
    });

    // Í±¥Î¨º Ïπ¥Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.building-card').forEach(card => {
        card.addEventListener('click', function() {
            const buildingId = this.getAttribute('data-building');
            // Í±¥Î¨º ÌÅ¥Î¶≠ Ïãú ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î™®Îã¨ ÎòêÎäî ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
            console.log('Selected building:', buildingId);
        });
    });

    // ÌôòÍ≤Ω Îç∞Ïù¥ÌÑ∞ Ï∞®Ìä∏
    const envCtx = document.getElementById('envChart').getContext('2d');
    envChart = new Chart(envCtx, {
        type: 'doughnut',
        data: {
            labels: ['Ïò®ÎèÑ', 'ÏäµÎèÑ', 'Í≥µÏã§Î•†'],
            datasets: [{
                data: [20, 60, 50],
                backgroundColor: ['#e74c3c', '#3498db', '#f39c12']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // ÏãúÍ∞ÑÎåÄÎ≥Ñ Ìå®ÌÑ¥ Ï∞®Ìä∏ - ÏôÑÏ†ÑÌûà ÏÉàÎ°úÏö¥ Íµ¨ÌòÑ
    const hourlyCtx = document.getElementById('hourlyChart').getContext('2d');
    
    // 24ÏãúÍ∞Ñ Í≥†Ï†ï Îç∞Ïù¥ÌÑ∞
    const hourlyLabels = ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23'];
    const hourlyData = [15, 12, 10, 8, 7, 6, 20, 25, 45, 55, 60, 65, 70, 68, 65, 62, 58, 55, 50, 40, 35, 30, 20, 18];
    const hourlyColors = [
        '#17a2b8', '#17a2b8', '#17a2b8', '#17a2b8', '#17a2b8', '#17a2b8', // 00-05Ïãú (Ïã¨Ïïº)
        '#28a745', '#28a745', // 06-07Ïãú (Ïù¥ÎèôÏãúÍ∞Ñ)
        '#ffc107', '#ffc107', '#ffc107', '#ffc107', '#ffc107', '#ffc107', '#ffc107', '#ffc107', '#ffc107', '#ffc107', // 08-17Ïãú (ÏóÖÎ¨¥ÏãúÍ∞Ñ)
        '#ffc107', // 18Ïãú (ÏóÖÎ¨¥ÏãúÍ∞Ñ)
        '#28a745', '#28a745', '#28a745', // 19-21Ïãú (Ïù¥ÎèôÏãúÍ∞Ñ)
        '#17a2b8', '#17a2b8' // 22-23Ïãú (Ïã¨Ïïº)
    ];
    
    hourlyChart = new Chart(hourlyCtx, {
        type: 'bar',
        data: {
            labels: hourlyLabels,
            datasets: [{
                label: 'ÌèâÍ∑† Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ',
                data: hourlyData,
                backgroundColor: hourlyColors,
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        title: function(context) {
                            const hour = parseInt(context[0].label);
                            const nextHour = (hour + 1) % 24;
                            return `${hour.toString().padStart(2, '0')}Ïãú-${nextHour.toString().padStart(2, '0')}Ïãú`;
                        },
                        label: function(context) {
                            return `ÌèâÍ∑† Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ: ${context.parsed.y.toFixed(1)} kWh`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        maxRotation: 0,
                        minRotation: 0
                    }
                },
                y: {
                    beginAtZero: true,
                    max: 80,
                    min: 0,
                    ticks: {
                        stepSize: 20
                    }
                }
            }
        }
    });

    // Í±¥Î¨ºÎ≥Ñ ÎπÑÍµê Ï∞®Ìä∏
    const buildingCtx = document.getElementById('buildingChart').getContext('2d');
    buildingChart = new Chart(buildingCtx, {
        type: 'bar',
        data: {
            labels: ['B001', 'B002', 'B003', 'B004', 'B005'],
            datasets: [{
                label: 'ÌèâÍ∑† Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ',
                data: [45, 38, 52, 41, 47],
                backgroundColor: ['#e74c3c', '#3498db', '#f39c12', '#2ecc71', '#9b59b6']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function loadRealTimeData() {
    // Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    $.ajax({
        url: '/api/real_time',
        method: 'GET',
        success: function(data) {
            const powerColor = getPowerColor(data.power_consumption);
            $('#current-power').text(data.power_consumption.toFixed(1) + ' kWh').removeClass().addClass('card-title ' + powerColor);
            $('#current-temp').text(data.temperature.toFixed(1));
            $('#current-occupancy').text(data.occupancy.toFixed(0));
            
            // Ïã§ÏãúÍ∞Ñ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            updateRealTimeChart(data);
        },
        error: function(xhr, status, error) {
            console.log('Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
        }
    });

    // ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    $.ajax({
        url: '/api/timeseries',
        method: 'GET',
        success: function(data) {
            updateTimeSeriesChart(data);
        },
        error: function(xhr, status, error) {
            console.log('ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
        }
    });
}

function updateRealTimeChart(data) {
    // ÌôòÍ≤Ω Îç∞Ïù¥ÌÑ∞ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
    envChart.data.datasets[0].data = [
        data.temperature,
        data.humidity,
        data.occupancy
    ];
    envChart.update();
}

function updateTimeSeriesChart(data) {
    // Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
    const labels = data.timestamps.map(t => new Date(Date.now() - (100 - t) * 60000).toLocaleTimeString());
    
    powerChart.data.labels = labels;
    powerChart.data.datasets[0].data = data.power_consumption;
    powerChart.update();
}

// ÏµúÍ∑º Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
// Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ ÏÉâÏÉÅ Í∏∞Ï§Ä Ìï®Ïàò
function getPowerColor(power) {
    if (power <= 10) {
        return 'text-primary'; // ÌååÎûÄÏÉâ (ÎÇÆÏùå)
    } else if (power <= 30) {
        return 'text-success'; // Ï¥àÎ°ùÏÉâ (Îß§Ïö∞ ÎÇÆÏùå)
    } else if (power <= 60) {
        return 'text-warning'; // ÎÖ∏ÎûÄÏÉâ (Î≥¥ÌÜµ)
    } else {
        return 'text-danger'; // Îπ®Í∞ÑÏÉâ (ÎÜíÏùå/Îß§Ïö∞ ÎÜíÏùå)
    }
}

function getPowerStatus(power) {
    if (power <= 10) {
        return 'Îß§Ïö∞ ÎÇÆÏùå';
    } else if (power <= 30) {
        return 'ÎÇÆÏùå';
    } else if (power <= 60) {
        return 'Î≥¥ÌÜµ';
    } else {
        return power > 100 ? 'Îß§Ïö∞ ÎÜíÏùå' : 'ÎÜíÏùå';
    }
}

function updateDataTable() {
    const tableBody = $('#data-table');
    tableBody.empty();
    
    // ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ (Ïã§Ï†úÎ°úÎäî APIÏóêÏÑú Í∞ÄÏ†∏Ïò¥)
    const sampleData = [
        { time: '14:30', building: 'B001', power: 45.2, temp: 22.5, humidity: 65, occupancy: 80 },
        { time: '14:25', building: 'B002', power: 38.7, temp: 21.8, humidity: 62, occupancy: 75 },
        { time: '14:20', building: 'B003', power: 52.1, temp: 23.2, humidity: 68, occupancy: 90 },
        { time: '14:15', building: 'B004', power: 41.3, temp: 22.0, humidity: 64, occupancy: 70 },
        { time: '14:10', building: 'B005', power: 47.8, temp: 22.8, humidity: 66, occupancy: 85 }
    ];
    
    sampleData.forEach(row => {
        const powerColor = getPowerColor(row.power);
        const powerStatus = getPowerStatus(row.power);
        const tr = `
            <tr>
                <td>${row.time}</td>
                <td>${row.building}</td>
                <td><span class="${powerColor} fw-bold">${row.power.toFixed(1)} kWh</span></td>
                <td>${row.temp}¬∞C</td>
                <td>${row.humidity}%</td>
                <td>${row.occupancy}%</td>
                <td><span class="badge bg-${powerColor.replace('text-', '')}">${powerStatus}</span></td>
            </tr>
        `;
        tableBody.append(tr);
    });
}

// Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î Î°úÎìú
updateDataTable();
</script>

<style>
    /* Building Cards Styles */
    .building-card {
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 15px;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        cursor: pointer;
        height: 100%;
    }
    
    .building-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-color: #007bff;
    }
    
    .building-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #f8f9fa;
    }
    
    .building-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin: 0;
        color: #2c3e50;
    }
    
    .building-status {
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 500;
    }
    
    .building-status.success {
        background-color: #d4edda;
        color: #155724;
    }
    
    .building-status.warning {
        background-color: #fff3cd;
        color: #856404;
    }
    
    .building-status.danger {
        background-color: #f8d7da;
        color: #721c24;
    }
    
    .building-floors {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .floor-item {
        padding: 8px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border-left: 3px solid #007bff;
    }
    
    .floor-item:hover {
        background-color: #e9ecef;
    }
    
    .floor-name {
        font-size: 0.8rem;
        font-weight: 500;
        color: #495057;
        display: block;
        margin-bottom: 4px;
    }
    
    .floor-stats {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    
    .floor-stats small {
        font-size: 0.7rem;
    }
    
    .temp-value, .power-value {
        font-weight: 600;
        color: #007bff;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .building-card {
            margin-bottom: 15px;
        }
        
        .building-title {
            font-size: 0.8rem;
        }
        
        .floor-name {
            font-size: 0.7rem;
        }
    }
</style>
{% endblock %}
