{% extends "base.html" %}

{% block title %}ìŠ¤ë§ˆíŠ¸ ì „ë ¥ ê´€ë¦¬ ì‹œìŠ¤í…œ - ê±´ë¬¼ ê´€ë¦¬ììš©{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- ğŸ“Š ì‹¤ì‹œê°„ ì•Œë¦¼ ëŒ€ì‹œë³´ë“œ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info border-0 shadow-sm" id="smart-alerts" style="display: none;">
                <div class="d-flex align-items-center">
                    <i class="fas fa-info-circle me-3 fs-4"></i>
                    <div class="flex-grow-1">
                        <strong>ì‹œìŠ¤í…œ ì•Œë¦¼:</strong> 
                        <span id="alert-content">í˜„ì¬ ì „ë ¥ ì‚¬ìš©ëŸ‰ì´ í‰ê· ë³´ë‹¤ 12% ë†’ìŠµë‹ˆë‹¤. ì¦‰ì‹œ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</span>
                    </div>
                    <button type="button" class="btn-close" onclick="dismissAlert()"></button>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸš€ ë¹ ë¥¸ ì•¡ì…˜ í—¤ë” -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h3 class="mb-2">
                                <i class="fas fa-bolt text-primary me-2"></i>
                                ìŠ¤ë§ˆíŠ¸ ì „ë ¥ ê´€ë¦¬ ì‹œìŠ¤í…œ
                            </h3>
                            <p class="text-muted mb-0">ì‹¤ì‹œê°„ AI ì˜ˆì¸¡ìœ¼ë¡œ íš¨ìœ¨ì ì¸ ì—ë„ˆì§€ ê´€ë¦¬ì™€ ë¹„ìš© ì ˆì•½ì„ ì‹¤í˜„í•˜ì„¸ìš”</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group" role="group">
                                <button class="btn btn-primary btn-sm" onclick="quickPredict()">
                                    <i class="fas fa-zap me-1"></i>ë¹ ë¥¸ ì˜ˆì¸¡
                                </button>
                                <button class="btn btn-success btn-sm" onclick="compareScenarios()">
                                    <i class="fas fa-chart-line me-1"></i>ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ
                                </button>
                                <button class="btn btn-info btn-sm" onclick="exportReport()">
                                    <i class="fas fa-download me-1"></i>ë³´ê³ ì„œ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“‹ ë©”ì¸ ì»¨í…ì¸  ì„¹ì…˜ -->
    <div class="row">
        <!-- ğŸ¢ ìŠ¤ë§ˆíŠ¸ ê±´ë¬¼ ì„ íƒ -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-building me-2"></i>ê±´ë¬¼ ì„ íƒ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="building_id" class="form-label fw-bold">ê±´ë¬¼ ì„ íƒ</label>
                            <select class="form-select" id="building_id" name="building_id" required onchange="updateBuildingInfo()">
                                <option value="">ê±´ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="B001">ğŸ¢ B001 - ë³¸ì‚¬ ê±´ë¬¼</option>
                                <option value="B002">ğŸ”¬ B002 - ì—°êµ¬ì†Œ</option>
                                <option value="B003">ğŸ­ B003 - ìƒì‚°ê³µì¥</option>
                                <option value="B004">ğŸ“¦ B004 - ì°½ê³ </option>
                                <option value="B005">ğŸ¢ B005 - ì‚¬ë¬´ì‹¤</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="floor_id" class="form-label fw-bold">ì¸µ ì„ íƒ</label>
                            <select class="form-select" id="floor_id" name="floor_id" required onchange="updateFloorInfo()">
                                <option value="">ì¸µì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="1">1ì¸µ</option>
                                <option value="2">2ì¸µ</option>
                                <option value="3">3ì¸µ</option>
                                <option value="4">4ì¸µ</option>
                                <option value="5">5ì¸µ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="building-info" class="alert alert-light" style="display: none;">
                        <i class="fas fa-info-circle me-2"></i>
                        <span id="building-description"></span>
                    </div>

                    <!-- ğŸ“Š ì‹¤ì‹œê°„ ì„¼ì„œ í˜„í™© -->
                    <div id="sensor-summary" class="mt-3" style="display: none;">
                        <h6 class="fw-bold mb-3">ì‹¤ì‹œê°„ í˜„í™©</h6>
                        <div class="row text-center">
                            <div class="col-6 mb-2">
                                <div class="sensor-card p-2 bg-light rounded">
                                    <div class="h5 mb-1" id="current-temp">--Â°C</div>
                                    <small class="text-muted">ì˜¨ë„</small>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="sensor-card p-2 bg-light rounded">
                                    <div class="h5 mb-1" id="current-power">--kWh</div>
                                    <small class="text-muted">ì „ë ¥</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="sensor-card p-2 bg-light rounded">
                                    <div class="h5 mb-1" id="current-hum">--%</div>
                                    <small class="text-muted">ìŠµë„</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="sensor-card p-2 bg-light rounded">
                                    <div class="h5 mb-1" id="current-occ">--ëª…</div>
                                    <small class="text-muted">ì¸ì›</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ğŸ”¥ ìŠ¤ë§ˆíŠ¸ í”„ë¦¬ì…‹ -->
                    <div class="mt-4">
                        <h6 class="fw-bold mb-3">ìŠ¤ë§ˆíŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h6>
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-outline-primary btn-sm w-100" onclick="setSmartPreset('office')">
                                    <i class="fas fa-business-time me-1"></i>ì—…ë¬´ì‹œê°„
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-danger btn-sm w-100" onclick="setSmartPreset('peak')">
                                    <i class="fas fa-fire me-1"></i>í”¼í¬ì‹œê°„
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-info btn-sm w-100" onclick="setSmartPreset('night')">
                                    <i class="fas fa-moon me-1"></i>ì•¼ê°„ëª¨ë“œ
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-secondary btn-sm w-100" onclick="setSmartPreset('weekend')">
                                    <i class="fas fa-calendar-week me-1"></i>ì£¼ë§
                                </button>
                            </div>
                        </div>
                        
                        <button class="btn btn-outline-success btn-sm w-100 mt-2" onclick="useCurrentData()">
                            <i class="fas fa-sync me-1"></i>í˜„ì¬ ë°ì´í„° ì ìš©
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- âš¡ ìŠ¤ë§ˆíŠ¸ ì˜ˆì¸¡ í¼ -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-cogs me-2"></i>ì˜ˆì¸¡ ì„¤ì •
                    </h5>
                </div>
                <div class="card-body">
                    <form id="prediction-form">
                        <div class="mb-3">
                            <label for="hour" class="form-label fw-bold">ì˜ˆì¸¡ ì‹œê°„</label>
                            <select class="form-select" id="hour" name="hour" required>
                                <option value="">ì‹œê°„ ì„ íƒ</option>
                                {% for h in range(24) %}
                                <option value="{{ h }}">{{ "%02d"|format(h) }}:00</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                ì˜¨ë„ ì„¤ì • 
                                <span class="badge bg-primary" id="temp-badge">22Â°C</span>
                            </label>
                            <input type="range" class="form-range" id="temperature" name="temperature" 
                                   min="15" max="30" value="22" oninput="updateTempValue(this.value)">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">15Â°C</small>
                                <small class="text-muted">30Â°C</small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                ìŠµë„ ì„¤ì • 
                                <span class="badge bg-info" id="hum-badge">50%</span>
                            </label>
                            <input type="range" class="form-range" id="humidity" name="humidity" 
                                   min="30" max="80" value="50" oninput="updateHumValue(this.value)">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">30%</small>
                                <small class="text-muted">80%</small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                ê³µì‹¤ë¥  
                                <span class="badge bg-warning" id="occ-badge">30%</span>
                            </label>
                            <input type="range" class="form-range" id="occupancy" name="occupancy" 
                                   min="0" max="100" value="30" oninput="updateOccValue(this.value)">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">0%</small>
                                <small class="text-muted">100%</small>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <label for="season" class="form-label fw-bold">ê³„ì ˆ</label>
                                <select class="form-select" id="season" name="season">
                                    <option value="spring">ë´„</option>
                                    <option value="summer" selected>ì—¬ë¦„</option>
                                    <option value="autumn">ê°€ì„</option>
                                    <option value="winter">ê²¨ìš¸</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label for="day_type" class="form-label fw-bold">ìš”ì¼</label>
                                <select class="form-select" id="day_type" name="day_type">
                                    <option value="weekday" selected>í‰ì¼</option>
                                    <option value="weekend">ì£¼ë§</option>
                                    <option value="holiday">ê³µíœ´ì¼</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 mt-4">
                            <i class="fas fa-magic me-2"></i>
                            AI ì˜ˆì¸¡ ì‹¤í–‰
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ğŸ“ˆ ì˜ˆì¸¡ ê²°ê³¼ & ì‹¤í–‰ ê°€ëŠ¥í•œ ê¶Œì¥ì‚¬í•­ -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-bar me-2"></i>ì˜ˆì¸¡ ê²°ê³¼ & ê¶Œì¥ì‚¬í•­
                    </h5>
                </div>
                <div class="card-body">
                    <!-- ë¡œë”© ìƒíƒœ -->
                    <div id="loading" class="text-center py-5" style="display: none;">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="text-muted">AIê°€ ìµœì ì˜ ì˜ˆì¸¡ì„ ê³„ì‚° ì¤‘ì…ë‹ˆë‹¤...</p>
                        <div class="progress mt-3" style="height: 6px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 100%"></div>
                        </div>
                        <small class="text-muted mt-2 d-block">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</small>
                    </div>

                    <!-- ì˜ˆì¸¡ ê²°ê³¼ -->
                    <div id="prediction-result" style="display: none;">
                        <div class="text-center mb-4">
                            <h4>ì˜ˆìƒ ì „ë ¥ ì‚¬ìš©ëŸ‰</h4>
                            <div id="prediction-value" class="display-4 fw-bold mb-2">--</div>
                            <div id="prediction-level" class="mb-3"></div>
                        </div>

                        <!-- íš¨ìœ¨ì„± ì ìˆ˜ -->
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center py-3">
                                <h6 class="card-title mb-2">ì—ë„ˆì§€ íš¨ìœ¨ì„±</h6>
                                <div class="progress progress-lg mb-2">
                                    <div class="progress-bar bg-success" id="efficiency-bar" style="width: 75%">75%</div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">í˜„ì¬ íš¨ìœ¨ì„±</small>
                                        <div class="h6" id="efficiency-percentage">75%</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">íš¨ìœ¨ ë“±ê¸‰</small>
                                        <div class="h6" id="efficiency-grade">B+</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì ˆì•½ ê°€ëŠ¥ëŸ‰ -->
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center py-3">
                                <h6 class="card-title mb-2">ì ˆì•½ ê°€ëŠ¥ëŸ‰</h6>
                                <div class="row">
                                    <div class="col-6">
                                        <div id="savings-power" class="h5 text-success">8.2 kWh</div>
                                        <small class="text-muted">ì „ë ¥ëŸ‰</small>
                                    </div>
                                    <div class="col-6">
                                        <div id="savings-cost" class="h5 text-success">â‚©1,230</div>
                                        <small class="text-muted">ë¹„ìš©</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì‹¤í–‰ ê°€ëŠ¥í•œ ê¶Œì¥ì‚¬í•­ -->
                        <div class="mt-4">
                            <h6 class="fw-bold mb-3"><i class="fas fa-lightbulb text-warning me-2"></i>ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ê¶Œì¥ì‚¬í•­</h6>
                            <div id="recommendations" class="list-group list-group-flush">
                                <!-- ê¶Œì¥ì‚¬í•­ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                            </div>
                        </div>
                    </div>

                    <!-- ì˜¤ë¥˜ ìƒíƒœ -->
                    <div id="error-message" class="alert alert-danger" style="display: none;">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <span id="error-text">ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
                    </div>

                    <!-- ì´ˆê¸° ìƒíƒœ -->
                    <div id="initial-state" class="text-center py-5 text-muted">
                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                        <h5>AI ì˜ˆì¸¡ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</h5>
                        <p>ê±´ë¬¼ì„ ì„ íƒí•˜ê³  ì¡°ê±´ì„ ì„¤ì •í•œ í›„ ì˜ˆì¸¡ì„ ì‹¤í–‰í•˜ì„¸ìš”</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ì„¹ì…˜ -->
    <div class="row mb-4" id="scenario-comparison" style="display: none;">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-balance-scale me-2"></i>ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ë¶„ì„
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <div class="scenario-card p-3 border rounded">
                                <h6 class="text-primary">í˜„ì¬ ì„¤ì •</h6>
                                <div class="h4" id="scenario-current">45 kWh</div>
                                <small class="text-muted">ì˜ˆìƒ ì‚¬ìš©ëŸ‰</small>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="scenario-card p-3 border rounded">
                                <h6 class="text-success">ìµœì í™” ì‹œ</h6>
                                <div class="h4" id="scenario-optimized">38 kWh</div>
                                <small class="text-muted">ìµœì í™” í›„</small>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="scenario-card p-3 border rounded">
                                <h6 class="text-info">ì ˆì•½ëŸ‰</h6>
                                <div class="h4" id="scenario-savings">7 kWh</div>
                                <small class="text-muted">ì ˆì•½ ê°€ëŠ¥</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ’° ì‹¤ì‹œê°„ ë¹„ìš© ë¶„ì„ -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-won-sign me-2"></i>ì‹¤ì‹œê°„ ë¹„ìš© ë¶„ì„
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="h3 text-success" id="daily-cost">â‚©12,450</div>
                            <small class="text-muted">ì˜¤ëŠ˜ ì˜ˆìƒ ë¹„ìš©</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h3 text-primary" id="monthly-cost">â‚©373,500</div>
                            <small class="text-muted">ì´ë‹¬ ì˜ˆìƒ ë¹„ìš©</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h3 text-warning" id="savings-today">â‚©2,180</div>
                            <small class="text-muted">ì˜¤ëŠ˜ ì ˆì•½ ê°€ëŠ¥</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h3 text-info" id="efficiency-ratio">85%</div>
                            <small class="text-muted">íš¨ìœ¨ì„± ë¹„ìœ¨</small>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <h6 class="fw-bold mb-2">ì›”ê°„ ì ˆì•½ ëª©í‘œ</h6>
                        <div class="progress progress-lg mb-2">
                            <div class="progress-bar bg-success" id="monthly-goal" style="width: 68%">68% ë‹¬ì„±</div>
                        </div>
                        <small class="text-muted">ëª©í‘œ: â‚©50,000 ì ˆì•½ / ë‹¬ì„±: â‚©34,000</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tasks me-2"></i>ì¦‰ì‹œ ì‹¤í–‰ ì•¡ì…˜
                    </h5>
                </div>
                <div class="card-body">
                    <div class="action-item mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">ğŸŒ¡ï¸ ì˜¨ë„ 2ë„ ë‚®ì¶”ê¸°</h6>
                                <small class="text-muted">ì˜ˆìƒ ì ˆì•½: â‚©1,200/ì¼</small>
                            </div>
                            <button class="btn btn-sm btn-success" onclick="applyAction('temp_down')">ì‹¤í–‰</button>
                        </div>
                    </div>
                    
                    <div class="action-item mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">ğŸ’¡ ë¶ˆí•„ìš”í•œ ì¡°ëª… ë„ê¸°</h6>
                                <small class="text-muted">ì˜ˆìƒ ì ˆì•½: â‚©800/ì¼</small>
                            </div>
                            <button class="btn btn-sm btn-success" onclick="applyAction('lights_off')">ì‹¤í–‰</button>
                        </div>
                    </div>
                    
                    <div class="action-item mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">âš¡ ëŒ€ê¸°ì „ë ¥ ì°¨ë‹¨</h6>
                                <small class="text-muted">ì˜ˆìƒ ì ˆì•½: â‚©500/ì¼</small>
                            </div>
                            <button class="btn btn-sm btn-success" onclick="applyAction('standby_off')">ì‹¤í–‰</button>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button class="btn btn-primary w-100" onclick="applyAllActions()">
                            <i class="fas fa-magic me-1"></i>ëª¨ë“  ê¶Œì¥ì‚¬í•­ í•œë²ˆì— ì ìš©
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ğŸ¨ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ -->
<style>
.sensor-card {
    transition: all 0.3s ease;
}

.sensor-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.scenario-card {
    transition: all 0.3s ease;
}

.scenario-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

.action-item {
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.action-item:hover {
    border-color: #007bff;
    transform: translateY(-1px);
}

.progress-lg {
    height: 25px;
}

.progress-lg .progress-bar {
    line-height: 25px;
    font-size: 0.9rem;
    font-weight: 500;
}

.bg-gradient {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
}

.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}

.btn {
    transition: all 0.3s ease;
}

.form-range::-webkit-slider-thumb {
    background: var(--primary-color);
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.form-range::-moz-range-thumb {
    background: var(--primary-color);
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

#prediction-value {
    font-family: 'Courier New', monospace;
    font-size: 2.5rem;
}

.list-group-item {
    border: none;
    padding: 0.5rem 0;
}

.alert {
    border-radius: 12px;
}

@keyframes pulse-success {
    0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
    100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
}

.btn-success.pulse {
    animation: pulse-success 2s infinite;
}
</style>

<!-- ğŸ”§ JavaScript ê¸°ëŠ¥ -->
<script>
// ê±´ë¬¼ ë°ì´í„°
const buildingData = {
    'B001': {
        name: 'ë³¸ì‚¬ ê±´ë¬¼',
        floors: 5,
        description: 'ë©”ì¸ ì˜¤í”¼ìŠ¤ ê±´ë¬¼ - ì¼ë°˜ ì‚¬ë¬´ì‹¤, íšŒì˜ì‹¤, ë¡œë¹„ í¬í•¨',
        floorData: {
            1: { name: 'ë¡œë¹„', sensors: { temp: 22, hum: 55, occ: 15, power: 45 } },
            2: { name: 'ì‚¬ë¬´ì‹¤', sensors: { temp: 24, hum: 50, occ: 25, power: 78 } },
            3: { name: 'íšŒì˜ì‹¤', sensors: { temp: 23, hum: 52, occ: 8, power: 35 } },
            4: { name: 'ê°œë³„ì‹¤', sensors: { temp: 24, hum: 51, occ: 12, power: 42 } },
            5: { name: 'ê´€ë¦¬ì‹¤', sensors: { temp: 23, hum: 53, occ: 5, power: 28 } }
        }
    },
    'B002': {
        name: 'ì—°êµ¬ì†Œ',
        floors: 3,
        description: 'ì—°êµ¬ê°œë°œ ì „ìš© ì‹œì„¤ - ì‹¤í—˜ì‹¤, í´ë¦°ë£¸, ë¶„ì„ì‹¤ í¬í•¨',
        floorData: {
            1: { name: 'ì¶œì…êµ¬', sensors: { temp: 21, hum: 48, occ: 5, power: 28 } },
            2: { name: 'ì‹¤í—˜ì‹¤', sensors: { temp: 22, hum: 45, occ: 12, power: 65 } },
            3: { name: 'í´ë¦°ë£¸', sensors: { temp: 20, hum: 40, occ: 6, power: 42 } }
        }
    },
    'B003': {
        name: 'ìƒì‚°ê³µì¥',
        floors: 2,
        description: 'ì œì¡° ë° ìƒì‚° ì‹œì„¤ - ìƒì‚°ë¼ì¸, í’ˆì§ˆê´€ë¦¬ì‹¤ í¬í•¨',
        floorData: {
            1: { name: 'ì°½ê³ ', sensors: { temp: 18, hum: 60, occ: 8, power: 55 } },
            2: { name: 'ìƒì‚°ë¼ì¸', sensors: { temp: 25, hum: 55, occ: 18, power: 120 } }
        }
    },
    'B004': {
        name: 'ì°½ê³ ',
        floors: 1,
        description: 'ë¬¼ë¥˜ ë° ë³´ê´€ ì‹œì„¤ - ì¼ë°˜ì°½ê³ , ëƒ‰ì¥ë³´ê´€ì‹¤ í¬í•¨',
        floorData: {
            1: { name: 'ë³´ê´€êµ¬ì—­', sensors: { temp: 16, hum: 65, occ: 3, power: 25 } }
        }
    },
    'B005': {
        name: 'ì‚¬ë¬´ì‹¤',
        floors: 4,
        description: 'ë¶€ì„œë³„ ì‚¬ë¬´ê³µê°„ - ì˜¤í”ˆì˜¤í”¼ìŠ¤, ê°œë³„ì‹¤, íšŒì˜ì‹¤ í¬í•¨',
        floorData: {
            1: { name: 'ì ‘ìˆ˜ì²˜', sensors: { temp: 23, hum: 53, occ: 12, power: 42 } },
            2: { name: 'ì˜¤í”ˆì˜¤í”¼ìŠ¤', sensors: { temp: 24, hum: 51, occ: 35, power: 95 } },
            3: { name: 'íšŒì˜ì‹¤', sensors: { temp: 22, hum: 54, occ: 15, power: 58 } },
            4: { name: 'ê°œë³„ì‹¤', sensors: { temp: 23, hum: 52, occ: 8, power: 38 } }
        }
    }
};

// ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ
function showSmartAlert(message, type = 'info') {
    const alertsDiv = document.getElementById('smart-alerts');
    const contentSpan = document.getElementById('alert-content');
    
    contentSpan.textContent = message;
    alertsDiv.className = `alert alert-${type} border-0 shadow-sm`;
    alertsDiv.style.display = 'block';
    
    // 10ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    setTimeout(() => {
        if (alertsDiv.style.display !== 'none') {
            dismissAlert();
        }
    }, 10000);
}

function dismissAlert() {
    document.getElementById('smart-alerts').style.display = 'none';
}

// ê±´ë¬¼ ì •ë³´ ì—…ë°ì´íŠ¸
function updateBuildingInfo() {
    const buildingId = document.getElementById('building_id').value;
    const floorSelect = document.getElementById('floor_id');
    const infoDiv = document.getElementById('building-info');
    const descSpan = document.getElementById('building-description');
    const sensorDiv = document.getElementById('sensor-summary');
    
    if (buildingId && buildingData[buildingId]) {
        const building = buildingData[buildingId];
        
        // ê±´ë¬¼ ì •ë³´ í‘œì‹œ
        descSpan.textContent = building.description;
        infoDiv.style.display = 'block';
        
        // ì¸µ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
        floorSelect.innerHTML = '<option value="">ì¸µì„ ì„ íƒí•˜ì„¸ìš”</option>';
        for (let i = 1; i <= building.floors; i++) {
            const floorName = building.floorData[i].name;
            floorSelect.innerHTML += `<option value="${i}">${i}ì¸µ - ${floorName}</option>`;
        }
        
        // ì¸µ ì„ íƒ ì´ˆê¸°í™”
        floorSelect.value = '';
        
        // ì„¼ì„œ ë°ì´í„° ìˆ¨ê¸°ê¸° (ì¸µ ì„ íƒ í›„ í‘œì‹œ)
        sensorDiv.style.display = 'none';
        
        // ìë™ìœ¼ë¡œ í˜„ì¬ ì‹œê°„ ì„¤ì •
        const now = new Date();
        document.getElementById('hour').value = now.getHours();
        
        showSmartAlert(`${building.name} ì„ íƒë¨. ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”.`, 'info');
    } else {
        infoDiv.style.display = 'none';
        sensorDiv.style.display = 'none';
        floorSelect.innerHTML = '<option value="">ì¸µì„ ì„ íƒí•˜ì„¸ìš”</option>';
    }
}

// ì¸µ ì •ë³´ ì—…ë°ì´íŠ¸
function updateFloorInfo() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    const sensorDiv = document.getElementById('sensor-summary');
    
    if (buildingId && floorId && buildingData[buildingId] && buildingData[buildingId].floorData[floorId]) {
        const building = buildingData[buildingId];
        const floor = building.floorData[floorId];
        
        // ì„¼ì„œ ë°ì´í„° í‘œì‹œ
        document.getElementById('current-temp').textContent = `${floor.sensors.temp}Â°C`;
        document.getElementById('current-power').textContent = `${floor.sensors.power}kWh`;
        document.getElementById('current-hum').textContent = `${floor.sensors.hum}%`;
        document.getElementById('current-occ').textContent = `${floor.sensors.occ}ëª…`;
        sensorDiv.style.display = 'block';
        
        // ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ í‘œì‹œ
        if (floor.sensors.power > 100) {
            showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name})ì˜ ì „ë ¥ ì‚¬ìš©ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤.`, 'warning');
        } else {
            showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name}) ì„ íƒë¨.`, 'success');
        }
    } else {
        sensorDiv.style.display = 'none';
    }
}

// ìŠ¤ë§ˆíŠ¸ í”„ë¦¬ì…‹ ì„¤ì •
function setSmartPreset(type) {
    const buildingId = document.getElementById('building_id').value;
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    const presets = {
        'office': { hour: 14, temp: 24, hum: 50, occ: 20 },
        'peak': { hour: 18, temp: 26, hum: 60, occ: 10 },
        'night': { hour: 2, temp: 20, hum: 45, occ: 80 },
        'weekend': { hour: 12, temp: 22, hum: 55, occ: 60 }
    };
    
    const preset = presets[type];
    if (preset) {
        document.getElementById('hour').value = preset.hour;
        document.getElementById('temperature').value = preset.temp;
        document.getElementById('humidity').value = preset.hum;
        document.getElementById('occupancy').value = preset.occ;
        
        updateTempValue(preset.temp);
        updateHumValue(preset.hum);
        updateOccValue(preset.occ);
        
        showSmartAlert(`${type === 'office' ? 'ì—…ë¬´ì‹œê°„' : type === 'peak' ? 'í”¼í¬ì‹œê°„' : type === 'night' ? 'ì•¼ê°„ëª¨ë“œ' : 'ì£¼ë§'} í”„ë¦¬ì…‹ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }
}

// í˜„ì¬ ë°ì´í„° ì‚¬ìš©
function useCurrentData() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ë¨¼ì € ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    const building = buildingData[buildingId];
    const floor = building.floorData[floorId];
    
    if (building && floor) {
        document.getElementById('temperature').value = floor.sensors.temp;
        document.getElementById('humidity').value = floor.sensors.hum;
        document.getElementById('occupancy').value = Math.round((floor.sensors.occ / 60) * 100);
        
        updateTempValue(floor.sensors.temp);
        updateHumValue(floor.sensors.hum);
        updateOccValue(Math.round((floor.sensors.occ / 60) * 100));
        
        // í˜„ì¬ ì‹œê°„ ì„¤ì •
        const now = new Date();
        document.getElementById('hour').value = now.getHours();
        
        showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name})ì˜ í˜„ì¬ ì„¼ì„œ ë°ì´í„°ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }
}

// ê°’ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
function updateTempValue(value) {
    document.getElementById('temp-badge').textContent = `${value}Â°C`;
}

function updateHumValue(value) {
    document.getElementById('hum-badge').textContent = `${value}%`;
}

function updateOccValue(value) {
    document.getElementById('occ-badge').textContent = `${value}%`;
}

// ë¹ ë¥¸ ì˜ˆì¸¡
function quickPredict() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ë¨¼ì € ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    // í˜„ì¬ ë°ì´í„°ë¡œ ìë™ ì„¤ì •
    useCurrentData();
    
    // 1ì´ˆ í›„ ì˜ˆì¸¡ ì‹¤í–‰
    setTimeout(() => {
        document.getElementById('prediction-form').dispatchEvent(new Event('submit'));
    }, 1000);
    
    showSmartAlert('ë¹ ë¥¸ ì˜ˆì¸¡ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
}

// ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ
function compareScenarios() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ë¨¼ì € ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    const comparisonDiv = document.getElementById('scenario-comparison');
    comparisonDiv.style.display = comparisonDiv.style.display === 'none' ? 'block' : 'none';
    
    if (comparisonDiv.style.display === 'block') {
        // ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ì—…ë°ì´íŠ¸
        const building = buildingData[buildingId];
        const floor = building.floorData[floorId];
        const currentPower = floor.sensors.power;
        const optimizedPower = Math.round(currentPower * 0.85);
        const savings = currentPower - optimizedPower;
        
        document.getElementById('scenario-current').textContent = `${currentPower} kWh`;
        document.getElementById('scenario-optimized').textContent = `${optimizedPower} kWh`;
        document.getElementById('scenario-savings').textContent = `${savings} kWh`;
        
        showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name}) ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ë¶„ì„ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
    }
}

// ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
function exportReport() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ë¨¼ì € ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    // ê°„ë‹¨í•œ ë³´ê³ ì„œ ìƒì„± ì‹œë®¬ë ˆì´ì…˜
    const building = buildingData[buildingId];
    const floor = building.floorData[floorId];
    const reportData = {
        building: building.name,
        floor: `${floorId}ì¸µ - ${floor.name}`,
        timestamp: new Date().toISOString(),
        power: floor.sensors.power,
        efficiency: 75,
        savings: Math.round(floor.sensors.power * 0.15)
    };
    
    // CSV í˜•íƒœë¡œ ë‹¤ìš´ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜
    const csvContent = `ê±´ë¬¼ëª…,ì¸µ,ì‹œê°„,ì „ë ¥ì‚¬ìš©ëŸ‰,íš¨ìœ¨ì„±,ì ˆì•½ê°€ëŠ¥ëŸ‰
${reportData.building},${reportData.floor},${new Date().toLocaleString()},${reportData.power}kWh,${reportData.efficiency}%,${reportData.savings}kWh`;
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `energy_report_${buildingId}_${floorId}F_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name}) ì—ë„ˆì§€ ë³´ê³ ì„œê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
}

// ì•¡ì…˜ ì‹¤í–‰
function applyAction(actionType) {
    const actions = {
        'temp_down': 'ì˜¨ë„ê°€ 2ë„ ë‚®ì¶°ì¡ŒìŠµë‹ˆë‹¤.',
        'lights_off': 'ë¶ˆí•„ìš”í•œ ì¡°ëª…ì´ êº¼ì¡ŒìŠµë‹ˆë‹¤.',
        'standby_off': 'ëŒ€ê¸°ì „ë ¥ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.'
    };
    
    const button = event.target;
    button.disabled = true;
    button.textContent = 'ì‹¤í–‰ë¨';
    button.classList.remove('btn-success');
    button.classList.add('btn-secondary');
    
    showSmartAlert(actions[actionType], 'success');
}

function applyAllActions() {
    const buttons = document.querySelectorAll('.action-item .btn-success');
    buttons.forEach(button => {
        button.click();
    });
    showSmartAlert('ëª¨ë“  ê¶Œì¥ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
}

// í¼ ì œì¶œ ì²˜ë¦¬
document.getElementById('prediction-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    const hour = document.getElementById('hour').value;
    
    if (!buildingId) {
        showSmartAlert('ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!hour) {
        showSmartAlert('ì˜ˆì¸¡ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    // UI ìƒíƒœ ë³€ê²½
    document.getElementById('loading').style.display = 'block';
    document.getElementById('prediction-result').style.display = 'none';
    document.getElementById('error-message').style.display = 'none';
    document.getElementById('initial-state').style.display = 'none';
    
    // í¼ ë°ì´í„° ìˆ˜ì§‘
    const hourValue = parseInt(hour) || 12;
    const temp = parseFloat(document.getElementById('temperature').value) || 22;
    const hum = parseFloat(document.getElementById('humidity').value) || 50;
    const occ = parseFloat(document.getElementById('occupancy').value) || 30;
    
    // ì‹¤ì œ ì˜ˆì¸¡ API í˜¸ì¶œ
    const predictionData = {
        building_id: buildingId,
        hour: hourValue,
        temperature: temp,
        humidity: hum,
        occupancy: occ
    };
    
    fetch('/api/predict', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(predictionData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('ì˜ˆì¸¡ ê²°ê³¼:', data);
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        // íš¨ìœ¨ì„± ê³„ì‚°
        let efficiency = 85;
        if (data.prediction > 100) efficiency = 60;
        else if (data.prediction > 80) efficiency = 70;
        else if (data.prediction > 60) efficiency = 80;
        
        // ì ˆì•½ëŸ‰ ê³„ì‚°
        const savings = Math.round(data.prediction * 0.15);
        const savingsCost = savings * 150; // kWhë‹¹ 150ì›
        
        // ê²°ê³¼ í‘œì‹œ
        showPredictionResult({
            power: data.prediction,
            efficiency: efficiency,
            savings: savings,
            savingsCost: savingsCost,
            level: data.level,
            color: data.color
        });
        
        // ì‹¤ì‹œê°„ ë¹„ìš© ì—…ë°ì´íŠ¸
        updateCostAnalysis(data.prediction);
        
        // ì„±ê³µ ì•Œë¦¼
        showSmartAlert(`ì˜ˆì¸¡ ì™„ë£Œ! ì˜ˆìƒ ì „ë ¥ ì‚¬ìš©ëŸ‰: ${data.prediction} kWh`, 'success');
    })
    .catch(error => {
        console.error('ì˜ˆì¸¡ ì˜¤ë¥˜:', error);
        
        // ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('error-text').textContent = `ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`;
        
        // ì˜¤ë¥˜ ì•Œë¦¼
        showSmartAlert(`ì˜ˆì¸¡ ì˜¤ë¥˜: ${error.message}`, 'danger');
    });
});

function showPredictionResult(data) {
    // ì „ë ¥ ì‚¬ìš©ëŸ‰ í‘œì‹œ
    document.getElementById('prediction-value').textContent = `${data.power} kWh`;
    
    // ë ˆë²¨ í‘œì‹œ (ì„œë²„ì—ì„œ ë°›ì€ ì •ë³´ ì‚¬ìš©)
    const level = data.level || 'ë³´í†µ';
    const levelClass = data.color || 'warning';
    
    document.getElementById('prediction-level').innerHTML = `<span class="badge bg-${levelClass}">${level}</span>`;
    
    // íš¨ìœ¨ì„± í‘œì‹œ
    document.getElementById('efficiency-bar').style.width = `${data.efficiency}%`;
    document.getElementById('efficiency-bar').textContent = `${data.efficiency}%`;
    document.getElementById('efficiency-percentage').textContent = `${data.efficiency}%`;
    
    // ë“±ê¸‰ ê³„ì‚°
    let grade;
    if (data.efficiency >= 85) grade = 'A+';
    else if (data.efficiency >= 75) grade = 'A';
    else if (data.efficiency >= 65) grade = 'B+';
    else if (data.efficiency >= 55) grade = 'B';
    else grade = 'C';
    
    document.getElementById('efficiency-grade').textContent = grade;
    
    // ì ˆì•½ëŸ‰ í‘œì‹œ
    document.getElementById('savings-power').textContent = `${data.savings} kWh`;
    document.getElementById('savings-cost').textContent = `â‚©${data.savingsCost.toLocaleString()}`;
    
    // ê¶Œì¥ì‚¬í•­ ìƒì„±
    const recommendations = [];
    if (data.power > 80) recommendations.push('ì—ì–´ì»¨ ì„¤ì • ì˜¨ë„ë¥¼ 1-2ë„ ë†’ì—¬ë³´ì„¸ìš”');
    if (data.efficiency < 70) recommendations.push('ë¶ˆí•„ìš”í•œ ì¥ë¹„ì˜ ì „ì›ì„ ì°¨ë‹¨í•˜ì„¸ìš”');
    if (data.power > 100) recommendations.push('í”¼í¬ ì‹œê°„ëŒ€ ì‚¬ìš©ëŸ‰ì„ ë¶„ì‚°ì‹œì¼œë³´ì„¸ìš”');
    recommendations.push('LED ì¡°ëª…ìœ¼ë¡œ êµì²´ë¥¼ ê²€í† í•´ë³´ì„¸ìš”');
    
    const recDiv = document.getElementById('recommendations');
    recDiv.innerHTML = recommendations.map(rec => 
        `<div class="list-group-item d-flex align-items-center">
            <i class="fas fa-check-circle text-success me-2"></i>
            <span>${rec}</span>
        </div>`
    ).join('');
    
    // ê²°ê³¼ í‘œì‹œ
    document.getElementById('loading').style.display = 'none';
    document.getElementById('prediction-result').style.display = 'block';
}

function updateCostAnalysis(predictedPower) {
    const dailyCost = predictedPower * 24 * 150;
    const monthlyCost = dailyCost * 30;
    const savingsToday = dailyCost * 0.15;
    
    document.getElementById('daily-cost').textContent = `â‚©${dailyCost.toLocaleString()}`;
    document.getElementById('monthly-cost').textContent = `â‚©${monthlyCost.toLocaleString()}`;
    document.getElementById('savings-today').textContent = `â‚©${Math.round(savingsToday).toLocaleString()}`;
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    // í˜„ì¬ ì‹œê°„ ìë™ ì„¤ì •
    const now = new Date();
    document.getElementById('hour').value = now.getHours();
    
    // ê³„ì ˆ ìë™ ì„¤ì •
    const month = now.getMonth() + 1;
    let season;
    if (month >= 3 && month <= 5) season = 'spring';
    else if (month >= 6 && month <= 8) season = 'summer';
    else if (month >= 9 && month <= 11) season = 'autumn';
    else season = 'winter';
    
    document.getElementById('season').value = season;
    
    // í‰ì¼/ì£¼ë§ ìë™ ì„¤ì •
    const dayOfWeek = now.getDay();
    document.getElementById('day_type').value = (dayOfWeek === 0 || dayOfWeek === 6) ? 'weekend' : 'weekday';
    
    // í™˜ì˜ ë©”ì‹œì§€
    setTimeout(() => {
        showSmartAlert('ìŠ¤ë§ˆíŠ¸ ì „ë ¥ ê´€ë¦¬ ì‹œìŠ¤í…œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ê±´ë¬¼ì„ ì„ íƒí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”.', 'info');
    }, 1000);
});
</script>

{% endblock %}