{% extends "base.html" %}

{% block title %}ìŠ¤ë§ˆíŠ¸ ì „ë ¥ ê´€ë¦¬ ì‹œìŠ¤í…œ - ê±´ë¬¼ ê´€ë¦¬ììš©{% endblock %}

{% block extra_css %}
<style>
    /* ì•Œë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes slideInFromRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOutToRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    /* ì•Œë¦¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
    #alert-container {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    }
    
    #alert-container::-webkit-scrollbar {
        width: 6px;
    }
    
    #alert-container::-webkit-scrollbar-track {
        background: transparent;
    }
    
    #alert-container::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 3px;
    }
    
    #alert-container::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.5);
    }
    
    /* ë‹¤í¬ëª¨ë“œì—ì„œ ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
    [data-theme="dark"] #alert-container .alert {
        background-color: var(--light-bg);
        border-color: #404040;
        color: var(--text-primary);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- ğŸ“Š ì‹¤ì‹œê°„ ì•Œë¦¼ ëŒ€ì‹œë³´ë“œ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info border-0 shadow-sm" id="smart-alerts" style="display: none;">
                <div class="d-flex align-items-center">
                    <i class="fas fa-info-circle me-3 fs-4"></i>
                    <div class="flex-grow-1">
                        <strong>ì‹œìŠ¤í…œ ì•Œë¦¼:</strong> 
                        <span id="alert-content">í˜„ì¬ ì „ë ¥ ì‚¬ìš©ëŸ‰ì´ í‰ê· ë³´ë‹¤ 12% ë†’ìŠµë‹ˆë‹¤. ì¦‰ì‹œ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</span>
                    </div>
                    <button type="button" class="btn-close" onclick="dismissAlert()"></button>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸš€ ë¹ ë¥¸ ì•¡ì…˜ í—¤ë” -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h3 class="mb-2">
                                <i class="fas fa-bolt text-primary me-2"></i>
                                ìŠ¤ë§ˆíŠ¸ ì „ë ¥ ê´€ë¦¬ ì‹œìŠ¤í…œ
                            </h3>
                            <p class="text-muted mb-0">ì‹¤ì‹œê°„ AI ì˜ˆì¸¡ìœ¼ë¡œ íš¨ìœ¨ì ì¸ ì—ë„ˆì§€ ê´€ë¦¬ì™€ ë¹„ìš© ì ˆì•½ì„ ì‹¤í˜„í•˜ì„¸ìš”</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group" role="group">
                                <button class="btn btn-primary btn-sm" onclick="quickPredict()">
                                    <i class="fas fa-zap me-1"></i>ë¹ ë¥¸ ì˜ˆì¸¡
                                </button>
                                <button class="btn btn-success btn-sm" onclick="compareScenarios()">
                                    <i class="fas fa-chart-line me-1"></i>ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ
                                </button>
                                <button class="btn btn-info btn-sm" onclick="exportReport()">
                                    <i class="fas fa-download me-1"></i>ë³´ê³ ì„œ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“‹ ë©”ì¸ ì»¨í…ì¸  ì„¹ì…˜ -->
    <div class="row">
        <!-- ğŸ¢ ìŠ¤ë§ˆíŠ¸ ê±´ë¬¼ ì„ íƒ -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-building me-2"></i>ê±´ë¬¼ ì„ íƒ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="building_id" class="form-label fw-bold">ê±´ë¬¼ ì„ íƒ</label>
                            <select class="form-select" id="building_id" name="building_id" required onchange="updateBuildingInfo()">
                                <option value="">ê±´ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="B001">ğŸ¢ B001 - ë³¸ì‚¬ ê±´ë¬¼</option>
                                <option value="B002">ğŸ”¬ B002 - ì—°êµ¬ì†Œ</option>
                                <option value="B003">ğŸ­ B003 - ìƒì‚°ê³µì¥</option>
                                <option value="B004">ğŸ“¦ B004 - ì°½ê³ </option>
                                <option value="B005">ğŸ¢ B005 - ì‚¬ë¬´ì‹¤</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="floor_id" class="form-label fw-bold">ì¸µ ì„ íƒ</label>
                            <select class="form-select" id="floor_id" name="floor_id" required onchange="updateFloorInfo()">
                                <option value="">ì¸µì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="1">1ì¸µ</option>
                                <option value="2">2ì¸µ</option>
                                <option value="3">3ì¸µ</option>
                                <option value="4">4ì¸µ</option>
                                <option value="5">5ì¸µ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="building-info" class="alert alert-light" style="display: none;">
                        <i class="fas fa-info-circle me-2"></i>
                        <span id="building-description"></span>
                    </div>

                    <!-- ğŸ“Š ì‹¤ì‹œê°„ ì„¼ì„œ í˜„í™© -->
                    <div id="sensor-summary" class="mt-3" style="display: none;">
                        <h6 class="fw-bold mb-3">ì‹¤ì‹œê°„ í˜„í™©</h6>
                        <div class="row text-center">
                            <div class="col-6 mb-2">
                                <div class="sensor-card p-2 bg-light rounded">
                                    <div class="h5 mb-1" id="current-temp">--Â°C</div>
                                    <small class="text-muted">ì˜¨ë„</small>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="sensor-card p-2 bg-light rounded">
                                    <div class="h5 mb-1" id="current-power">--kWh</div>
                                    <small class="text-muted">ì „ë ¥</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="sensor-card p-2 bg-light rounded">
                                    <div class="h5 mb-1" id="current-hum">--%</div>
                                    <small class="text-muted">ìŠµë„</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="sensor-card p-2 bg-light rounded">
                                    <div class="h5 mb-1" id="current-occ">--ëª…</div>
                                    <small class="text-muted">ì¸ì›</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ğŸ”¥ ìŠ¤ë§ˆíŠ¸ í”„ë¦¬ì…‹ -->
                    <div class="mt-4">
                        <h6 class="fw-bold mb-3">ìŠ¤ë§ˆíŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h6>
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-outline-primary btn-sm w-100" onclick="setSmartPreset('office')">
                                    <i class="fas fa-business-time me-1"></i>ì—…ë¬´ì‹œê°„
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-danger btn-sm w-100" onclick="setSmartPreset('peak')">
                                    <i class="fas fa-fire me-1"></i>í”¼í¬ì‹œê°„
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-info btn-sm w-100" onclick="setSmartPreset('night')">
                                    <i class="fas fa-moon me-1"></i>ì•¼ê°„ëª¨ë“œ
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-secondary btn-sm w-100" onclick="setSmartPreset('weekend')">
                                    <i class="fas fa-calendar-week me-1"></i>ì£¼ë§
                                </button>
                            </div>
                        </div>
                        
                        <button class="btn btn-outline-success btn-sm w-100 mt-2" onclick="useCurrentData()">
                            <i class="fas fa-sync me-1"></i>í˜„ì¬ ë°ì´í„° ì ìš©
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- âš¡ ìŠ¤ë§ˆíŠ¸ ì˜ˆì¸¡ í¼ -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-cogs me-2"></i>ì˜ˆì¸¡ ì„¤ì •
                    </h5>
                </div>
                <div class="card-body">
                    <form id="prediction-form">
                        <div class="mb-3">
                            <label for="hour" class="form-label fw-bold">ì˜ˆì¸¡ ì‹œê°„</label>
                            <select class="form-select" id="hour" name="hour" required>
                                <option value="">ì‹œê°„ ì„ íƒ</option>
                                {% for h in range(24) %}
                                <option value="{{ h }}">{{ "%02d"|format(h) }}:00</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                ì˜¨ë„ ì„¤ì • 
                                <span class="badge bg-primary" id="temp-badge">22Â°C</span>
                            </label>
                            <input type="range" class="form-range" id="temperature" name="temperature" 
                                   min="15" max="30" value="22" oninput="updateTempValue(this.value)">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">15Â°C</small>
                                <small class="text-muted">30Â°C</small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                ìŠµë„ ì„¤ì • 
                                <span class="badge bg-info" id="hum-badge">50%</span>
                            </label>
                            <input type="range" class="form-range" id="humidity" name="humidity" 
                                   min="30" max="80" value="50" oninput="updateHumValue(this.value)">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">30%</small>
                                <small class="text-muted">80%</small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                ê³µì‹¤ë¥  
                                <span class="badge bg-warning" id="occ-badge">30%</span>
                            </label>
                            <input type="range" class="form-range" id="occupancy" name="occupancy" 
                                   min="0" max="100" value="30" oninput="updateOccValue(this.value)">
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">0%</small>
                                <small class="text-muted">100%</small>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <label for="season" class="form-label fw-bold">ê³„ì ˆ</label>
                                <select class="form-select" id="season" name="season">
                                    <option value="spring">ë´„</option>
                                    <option value="summer" selected>ì—¬ë¦„</option>
                                    <option value="autumn">ê°€ì„</option>
                                    <option value="winter">ê²¨ìš¸</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label for="day_type" class="form-label fw-bold">ìš”ì¼</label>
                                <select class="form-select" id="day_type" name="day_type">
                                    <option value="weekday" selected>í‰ì¼</option>
                                    <option value="weekend">ì£¼ë§</option>
                                    <option value="holiday">ê³µíœ´ì¼</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 mt-4">
                            <i class="fas fa-magic me-2"></i>
                            AI ì˜ˆì¸¡ ì‹¤í–‰
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ğŸ“ˆ ì˜ˆì¸¡ ê²°ê³¼ & ì‹¤í–‰ ê°€ëŠ¥í•œ ê¶Œì¥ì‚¬í•­ -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-bar me-2"></i>ì˜ˆì¸¡ ê²°ê³¼ & ê¶Œì¥ì‚¬í•­
                    </h5>
                </div>
                <div class="card-body">
                    <!-- ë¡œë”© ìƒíƒœ -->
                    <div id="loading" class="text-center py-5" style="display: none;">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="text-muted">AIê°€ ìµœì ì˜ ì˜ˆì¸¡ì„ ê³„ì‚° ì¤‘ì…ë‹ˆë‹¤...</p>
                        <div class="progress mt-3" style="height: 6px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 100%"></div>
                        </div>
                        <small class="text-muted mt-2 d-block">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</small>
                    </div>

                    <!-- ì˜ˆì¸¡ ê²°ê³¼ -->
                    <div id="prediction-result" style="display: none;">
                        <div class="text-center mb-4">
                            <h4>ì˜ˆìƒ ì „ë ¥ ì‚¬ìš©ëŸ‰</h4>
                            <div id="prediction-value" class="display-4 fw-bold mb-2">--</div>
                            <div id="prediction-level" class="mb-3"></div>
                        </div>

                        <!-- íš¨ìœ¨ì„± ì ìˆ˜ -->
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center py-3">
                                <h6 class="card-title mb-2">ì—ë„ˆì§€ íš¨ìœ¨ì„±</h6>
                                <div class="progress progress-lg mb-2">
                                    <div class="progress-bar bg-success" id="efficiency-bar" style="width: 75%">75%</div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">í˜„ì¬ íš¨ìœ¨ì„±</small>
                                        <div class="h6" id="efficiency-percentage">75%</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">íš¨ìœ¨ ë“±ê¸‰</small>
                                        <div class="h6" id="efficiency-grade">B+</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì ˆì•½ ê°€ëŠ¥ëŸ‰ -->
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center py-3">
                                <h6 class="card-title mb-2">ì ˆì•½ ê°€ëŠ¥ëŸ‰</h6>
                                <div class="row">
                                    <div class="col-6">
                                        <div id="savings-power" class="h5 text-success">8.2 kWh</div>
                                        <small class="text-muted">ì „ë ¥ëŸ‰</small>
                                    </div>
                                    <div class="col-6">
                                        <div id="savings-cost" class="h5 text-success">â‚©1,230</div>
                                        <small class="text-muted">ë¹„ìš©</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì‹¤í–‰ ê°€ëŠ¥í•œ ê¶Œì¥ì‚¬í•­ -->
                        <div class="mt-4">
                            <h6 class="fw-bold mb-3"><i class="fas fa-lightbulb text-warning me-2"></i>ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ê¶Œì¥ì‚¬í•­</h6>
                            <div id="recommendations" class="list-group list-group-flush">
                                <!-- ê¶Œì¥ì‚¬í•­ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                            </div>
                        </div>
                    </div>

                    <!-- ì˜¤ë¥˜ ìƒíƒœ -->
                    <div id="error-message" class="alert alert-danger" style="display: none;">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <span id="error-text">ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
                    </div>

                    <!-- ì´ˆê¸° ìƒíƒœ -->
                    <div id="initial-state" class="text-center py-5 text-muted">
                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                        <h5>AI ì˜ˆì¸¡ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</h5>
                        <p>ê±´ë¬¼ì„ ì„ íƒí•˜ê³  ì¡°ê±´ì„ ì„¤ì •í•œ í›„ ì˜ˆì¸¡ì„ ì‹¤í–‰í•˜ì„¸ìš”</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ¯ ìŠ¤ë§ˆíŠ¸ ì—ë„ˆì§€ ìµœì í™” ì‹œë‚˜ë¦¬ì˜¤ -->
    <div class="row mb-4" id="scenario-comparison" style="display: none;">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-lightbulb me-2"></i>ìŠ¤ë§ˆíŠ¸ ì—ë„ˆì§€ ìµœì í™” ì‹œë‚˜ë¦¬ì˜¤
                    </h5>
                    <small class="text-white-50">AIê°€ ë¶„ì„í•œ ìµœì ì˜ ì—ë„ˆì§€ ì ˆì•½ ë°©ì•ˆì„ ë¹„êµí•´ë³´ì„¸ìš”</small>
                </div>
                <div class="card-body">
                    <!-- ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ íƒ­ -->
                    <ul class="nav nav-tabs mb-4" id="scenarioTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="current-tab" data-bs-toggle="tab" data-bs-target="#current" type="button" role="tab">
                                <i class="fas fa-cog me-1"></i>í˜„ì¬ ìš´ì˜
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="optimized-tab" data-bs-toggle="tab" data-bs-target="#optimized" type="button" role="tab">
                                <i class="fas fa-magic me-1"></i>AI ìµœì í™”
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="eco-tab" data-bs-toggle="tab" data-bs-target="#eco" type="button" role="tab">
                                <i class="fas fa-leaf me-1"></i>ì—ì½” ëª¨ë“œ
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab">
                                <i class="fas fa-rocket me-1"></i>ì„±ëŠ¥ ëª¨ë“œ
                            </button>
                        </li>
                    </ul>

                    <!-- ì‹œë‚˜ë¦¬ì˜¤ ë‚´ìš© -->
                    <div class="tab-content" id="scenarioTabContent">
                        <!-- í˜„ì¬ ìš´ì˜ ì‹œë‚˜ë¦¬ì˜¤ -->
                        <div class="tab-pane fade show active" id="current" role="tabpanel">
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="text-primary mb-3">
                                        <i class="fas fa-info-circle me-1"></i>í˜„ì¬ ìš´ì˜ ìƒíƒœ
                                    </h6>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="scenario-stat-card p-3 bg-light rounded">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-bolt text-warning me-2"></i>
                                                    <div>
                                                        <div class="h5 mb-0" id="current-power">78 kWh</div>
                                                        <small class="text-muted">ì¼ì¼ ì „ë ¥ ì‚¬ìš©ëŸ‰</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="scenario-stat-card p-3 bg-light rounded">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-won-sign text-success me-2"></i>
                                                    <div>
                                                        <div class="h5 mb-0" id="current-cost">â‚©23,400</div>
                                                        <small class="text-muted">ì¼ì¼ ì „ê¸°ìš”ê¸ˆ</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-info">
                                        <h6><i class="fas fa-clipboard-list me-1"></i>í˜„ì¬ ìš´ì˜ ì„¤ì •</h6>
                                        <ul class="mb-0">
                                            <li>HVAC ì˜¨ë„: 22Â°C (ìë™ ëª¨ë“œ)</li>
                                            <li>ì¡°ëª…: 80% ë°ê¸° (ì—…ë¬´ì‹œê°„ ê¸°ì¤€)</li>
                                            <li>ëŒ€ê¸°ì „ë ¥: í™œì„±í™”</li>
                                            <li>ì¸ì› ê°ì§€: ë¹„í™œì„±í™”</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <div class="scenario-efficiency-circle mb-3">
                                            <div class="efficiency-ring">
                                                <span class="efficiency-text">75%</span>
                                            </div>
                                        </div>
                                        <h6 class="text-muted">í˜„ì¬ íš¨ìœ¨ì„±</h6>
                                        <small class="text-muted">ê¸°ë³¸ ìš´ì˜ ê¸°ì¤€</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI ìµœì í™” ì‹œë‚˜ë¦¬ì˜¤ -->
                        <div class="tab-pane fade" id="optimized" role="tabpanel">
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="text-success mb-3">
                                        <i class="fas fa-robot me-1"></i>AI ê¶Œì¥ ìµœì í™” ë°©ì•ˆ
                                    </h6>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="scenario-stat-card p-3 bg-success bg-opacity-10 rounded border border-success">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-bolt text-success me-2"></i>
                                                    <div>
                                                        <div class="h5 mb-0 text-success" id="optimized-power">64 kWh</div>
                                                        <small class="text-muted">ì˜ˆìƒ ì „ë ¥ ì‚¬ìš©ëŸ‰</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="scenario-stat-card p-3 bg-success bg-opacity-10 rounded border border-success">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-won-sign text-success me-2"></i>
                                                    <div>
                                                        <div class="h5 mb-0 text-success" id="optimized-cost">â‚©19,200</div>
                                                        <small class="text-muted">ì˜ˆìƒ ì „ê¸°ìš”ê¸ˆ</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-success">
                                        <h6><i class="fas fa-check-circle me-1"></i>ê¶Œì¥ ìµœì í™” ì„¤ì •</h6>
                                        <ul class="mb-0">
                                            <li><strong>HVAC ì˜¨ë„:</strong> 24Â°C (ì ˆì•½ ëª¨ë“œ) - <span class="text-success">2Â°C ìƒìŠ¹</span></li>
                                            <li><strong>ì¡°ëª…:</strong> 70% ë°ê¸° (ìë™ ì¡°ì ˆ) - <span class="text-success">10% ì ˆì•½</span></li>
                                            <li><strong>ëŒ€ê¸°ì „ë ¥:</strong> ìë™ ì°¨ë‹¨ - <span class="text-success">ìŠ¤ë§ˆíŠ¸ ì œì–´</span></li>
                                            <li><strong>ì¸ì› ê°ì§€:</strong> í™œì„±í™” - <span class="text-success">ìë™ ì¡°ì ˆ</span></li>
                                        </ul>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-6">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="h6 text-success mb-1">â‚©4,200</div>
                                                <small class="text-muted">ì¼ì¼ ì ˆì•½ ê¸ˆì•¡</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="h6 text-success mb-1">18%</div>
                                                <small class="text-muted">ì ˆì•½ ë¹„ìœ¨</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <div class="scenario-efficiency-circle mb-3">
                                            <div class="efficiency-ring optimized">
                                                <span class="efficiency-text">93%</span>
                                            </div>
                                        </div>
                                        <h6 class="text-success">ìµœì í™” íš¨ìœ¨ì„±</h6>
                                        <small class="text-muted">AI ê¶Œì¥ ê¸°ì¤€</small>
                                        <div class="mt-3">
                                            <button class="btn btn-success btn-sm" onclick="applyOptimization()">
                                                <i class="fas fa-magic me-1"></i>ìµœì í™” ì ìš©
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì—ì½” ëª¨ë“œ ì‹œë‚˜ë¦¬ì˜¤ -->
                        <div class="tab-pane fade" id="eco" role="tabpanel">
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="text-warning mb-3">
                                        <i class="fas fa-leaf me-1"></i>ìµœëŒ€ ì ˆì•½ ëª¨ë“œ
                                    </h6>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="scenario-stat-card p-3 bg-warning bg-opacity-10 rounded border border-warning">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-bolt text-warning me-2"></i>
                                                    <div>
                                                        <div class="h5 mb-0 text-warning" id="eco-power">59 kWh</div>
                                                        <small class="text-muted">ì˜ˆìƒ ì „ë ¥ ì‚¬ìš©ëŸ‰</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="scenario-stat-card p-3 bg-warning bg-opacity-10 rounded border border-warning">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-won-sign text-warning me-2"></i>
                                                    <div>
                                                        <div class="h5 mb-0 text-warning" id="eco-cost">â‚©17,700</div>
                                                        <small class="text-muted">ì˜ˆìƒ ì „ê¸°ìš”ê¸ˆ</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-warning">
                                        <h6><i class="fas fa-exclamation-triangle me-1"></i>ê·¹í•œ ì ˆì•½ ì„¤ì • (í¸ì˜ì„± ì €í•˜)</h6>
                                        <ul class="mb-0">
                                            <li><strong>HVAC ì˜¨ë„:</strong> 26Â°C (ì ˆì•½ ëª¨ë“œ) - <span class="text-warning">4Â°C ìƒìŠ¹</span></li>
                                            <li><strong>ì¡°ëª…:</strong> 50% ë°ê¸° (ìµœì†Œ ì¡°ëª…) - <span class="text-warning">30% ì ˆì•½</span></li>
                                            <li><strong>ëŒ€ê¸°ì „ë ¥:</strong> ì™„ì „ ì°¨ë‹¨ - <span class="text-warning">ìˆ˜ë™ ì œì–´</span></li>
                                            <li><strong>ì¸ì› ê°ì§€:</strong> ê°•í™” ëª¨ë“œ - <span class="text-warning">ìë™ ì°¨ë‹¨</span></li>
                                        </ul>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-6">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="h6 text-warning mb-1">â‚©5,700</div>
                                                <small class="text-muted">ì¼ì¼ ì ˆì•½ ê¸ˆì•¡</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="h6 text-warning mb-1">25%</div>
                                                <small class="text-muted">ì ˆì•½ ë¹„ìœ¨</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <div class="scenario-efficiency-circle mb-3">
                                            <div class="efficiency-ring eco">
                                                <span class="efficiency-text">98%</span>
                                            </div>
                                        </div>
                                        <h6 class="text-warning">ì—ì½” íš¨ìœ¨ì„±</h6>
                                        <small class="text-muted">ìµœëŒ€ ì ˆì•½ ê¸°ì¤€</small>
                                        <div class="mt-3">
                                            <button class="btn btn-warning btn-sm" onclick="applyEcoMode()">
                                                <i class="fas fa-leaf me-1"></i>ì—ì½” ëª¨ë“œ ì ìš©
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì„±ëŠ¥ ëª¨ë“œ ì‹œë‚˜ë¦¬ì˜¤ -->
                        <div class="tab-pane fade" id="performance" role="tabpanel">
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="text-danger mb-3">
                                        <i class="fas fa-rocket me-1"></i>ìµœê³  ì„±ëŠ¥ ëª¨ë“œ
                                    </h6>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="scenario-stat-card p-3 bg-danger bg-opacity-10 rounded border border-danger">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-bolt text-danger me-2"></i>
                                                    <div>
                                                        <div class="h5 mb-0 text-danger" id="performance-power">95 kWh</div>
                                                        <small class="text-muted">ì˜ˆìƒ ì „ë ¥ ì‚¬ìš©ëŸ‰</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="scenario-stat-card p-3 bg-danger bg-opacity-10 rounded border border-danger">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-won-sign text-danger me-2"></i>
                                                    <div>
                                                        <div class="h5 mb-0 text-danger" id="performance-cost">â‚©28,500</div>
                                                        <small class="text-muted">ì˜ˆìƒ ì „ê¸°ìš”ê¸ˆ</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                                                         <div class="alert alert-danger bg-danger bg-opacity-10 border border-danger">
                                         <h6><i class="fas fa-fire me-1"></i>ìµœê³  ì„±ëŠ¥ ì„¤ì • (ë¹„ìš© ì¦ê°€)</h6>
                                         <ul class="mb-0">
                                             <li><strong>HVAC ì˜¨ë„:</strong> 20Â°C (ëƒ‰ë°© ê°•í™”) - <span class="text-danger">2Â°C í•˜ê°•</span></li>
                                             <li><strong>ì¡°ëª…:</strong> 100% ë°ê¸° (ìµœëŒ€ ì¡°ëª…) - <span class="text-danger">20% ì¦ê°€</span></li>
                                             <li><strong>ëŒ€ê¸°ì „ë ¥:</strong> ì™„ì „ í™œì„±í™” - <span class="text-danger">ì¦‰ì‹œ ëŒ€ê¸°</span></li>
                                             <li><strong>ì¸ì› ê°ì§€:</strong> ë¹„í™œì„±í™” - <span class="text-danger">ìˆ˜ë™ ì œì–´</span></li>
                                         </ul>
                                     </div>
                                    <div class="row mt-3">
                                        <div class="col-6">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="h6 text-danger mb-1">-â‚©5,100</div>
                                                <small class="text-muted">ì¶”ê°€ ë¹„ìš©</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center p-2 bg-light rounded">
                                                <div class="h6 text-danger mb-1">+22%</div>
                                                <small class="text-muted">ì‚¬ìš©ëŸ‰ ì¦ê°€</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <div class="scenario-efficiency-circle mb-3">
                                            <div class="efficiency-ring performance">
                                                <span class="efficiency-text">45%</span>
                                            </div>
                                        </div>
                                        <h6 class="text-danger">ì„±ëŠ¥ íš¨ìœ¨ì„±</h6>
                                        <small class="text-muted">ìµœê³  ì„±ëŠ¥ ê¸°ì¤€</small>
                                        <div class="mt-3">
                                            <button class="btn btn-danger btn-sm" onclick="applyPerformanceMode()">
                                                <i class="fas fa-rocket me-1"></i>ì„±ëŠ¥ ëª¨ë“œ ì ìš©
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ’° ì‹¤ì‹œê°„ ë¹„ìš© ë¶„ì„ -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-won-sign me-2"></i>ì‹¤ì‹œê°„ ë¹„ìš© ë¶„ì„
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="h3 text-success" id="daily-cost">â‚©12,450</div>
                            <small class="text-muted">ì˜¤ëŠ˜ ì˜ˆìƒ ë¹„ìš©</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h3 text-primary" id="monthly-cost">â‚©373,500</div>
                            <small class="text-muted">ì´ë‹¬ ì˜ˆìƒ ë¹„ìš©</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h3 text-warning" id="savings-today">â‚©2,180</div>
                            <small class="text-muted">ì˜¤ëŠ˜ ì ˆì•½ ê°€ëŠ¥</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h3 text-info" id="efficiency-ratio">85%</div>
                            <small class="text-muted">íš¨ìœ¨ì„± ë¹„ìœ¨</small>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <h6 class="fw-bold mb-2">ì›”ê°„ ì ˆì•½ ëª©í‘œ</h6>
                        <div class="progress progress-lg mb-2">
                            <div class="progress-bar bg-success" id="monthly-goal" style="width: 68%">68% ë‹¬ì„±</div>
                        </div>
                        <small class="text-muted">ëª©í‘œ: â‚©50,000 ì ˆì•½ / ë‹¬ì„±: â‚©34,000</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tasks me-2"></i>ì¦‰ì‹œ ì‹¤í–‰ ì•¡ì…˜
                    </h5>
                </div>
                <div class="card-body">
                    <div class="action-item mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">ğŸŒ¡ï¸ ì˜¨ë„ 2ë„ ë‚®ì¶”ê¸°</h6>
                                <small class="text-muted">ì˜ˆìƒ ì ˆì•½: â‚©1,200/ì¼</small>
                            </div>
                            <button class="btn btn-sm btn-success" onclick="applyAction('temp_down')">ì‹¤í–‰</button>
                        </div>
                    </div>
                    
                    <div class="action-item mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">ğŸ’¡ ë¶ˆí•„ìš”í•œ ì¡°ëª… ë„ê¸°</h6>
                                <small class="text-muted">ì˜ˆìƒ ì ˆì•½: â‚©800/ì¼</small>
                            </div>
                            <button class="btn btn-sm btn-success" onclick="applyAction('lights_off')">ì‹¤í–‰</button>
                        </div>
                    </div>
                    
                    <div class="action-item mb-3 p-3 bg-light rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">âš¡ ëŒ€ê¸°ì „ë ¥ ì°¨ë‹¨</h6>
                                <small class="text-muted">ì˜ˆìƒ ì ˆì•½: â‚©500/ì¼</small>
                            </div>
                            <button class="btn btn-sm btn-success" onclick="applyAction('standby_off')">ì‹¤í–‰</button>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button class="btn btn-primary w-100" onclick="applyAllActions()">
                            <i class="fas fa-magic me-1"></i>ëª¨ë“  ê¶Œì¥ì‚¬í•­ í•œë²ˆì— ì ìš©
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“Š ì˜ˆì¸¡ ì°¨íŠ¸ ì„¹ì…˜ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-line me-2"></i>ì˜ˆì¸¡ vs ì‹¤ì œ ë¹„êµ ì°¨íŠ¸
                    </h5>
                </div>
                <div class="card-body">
                    <div id="prediction-chart" style="height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“ˆ ì‹œê°„ëŒ€ë³„ ì „ë ¥ ì‚¬ìš©ëŸ‰ íŠ¸ë Œë“œ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-area me-2"></i>ì‹œê°„ëŒ€ë³„ ì „ë ¥ ì‚¬ìš©ëŸ‰ íŠ¸ë Œë“œ
                    </h5>
                </div>
                <div class="card-body">
                    <div id="trend-chart" style="height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ğŸ¨ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ -->
<style>
.sensor-card {
    transition: all 0.3s ease;
}

.sensor-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.scenario-card {
    transition: all 0.3s ease;
}

.scenario-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

.scenario-stat-card {
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.scenario-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.action-item {
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.action-item:hover {
    border-color: #007bff;
    transform: translateY(-1px);
}

.progress-lg {
    height: 25px;
}

.progress-lg .progress-bar {
    line-height: 25px;
    font-size: 0.9rem;
    font-weight: 500;
}

.bg-gradient {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
}

.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
}

/* íš¨ìœ¨ì„± ì›í˜• ì°¨íŠ¸ ìŠ¤íƒ€ì¼ */
.scenario-efficiency-circle {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto;
}

.efficiency-ring {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: conic-gradient(
        #e9ecef 0deg 360deg
    );
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: all 0.5s ease;
}

.efficiency-ring::before {
    content: '';
    position: absolute;
    width: 80%;
    height: 80%;
    border-radius: 50%;
    background: white;
    z-index: 1;
}

.efficiency-ring.optimized {
    background: conic-gradient(
        #28a745 0deg 335deg,
        #e9ecef 335deg 360deg
    );
}

.efficiency-ring.eco {
    background: conic-gradient(
        #ffc107 0deg 353deg,
        #e9ecef 353deg 360deg
    );
}

.efficiency-ring.performance {
    background: conic-gradient(
        #dc3545 0deg 162deg,
        #e9ecef 162deg 360deg
    );
}

.efficiency-text {
    font-size: 1.5rem;
    font-weight: bold;
    color: #2c3e50;
    z-index: 2;
    position: relative;
}

 /* ë‹¤í¬ëª¨ë“œ ì§€ì› */
 [data-theme="dark"] .efficiency-ring::before {
     background: #2d2d2d;
 }

 [data-theme="dark"] .efficiency-text {
     color: #ffffff;
 }

 [data-theme="dark"] .scenario-stat-card {
     background-color: #2d2d2d !important;
     border-color: #404040 !important;
 }

 [data-theme="dark"] .scenario-stat-card:hover {
     background-color: #3d3d3d !important;
 }

 /* ì„±ëŠ¥ëª¨ë“œ ì•Œë¦¼ ë°•ìŠ¤ ê°œì„  */
 .alert-danger.bg-danger.bg-opacity-10 {
     background-color: rgba(220, 53, 69, 0.08) !important;
     border-color: rgba(220, 53, 69, 0.3) !important;
     color: #2c3e50;
 }

 [data-theme="dark"] .alert-danger.bg-danger.bg-opacity-10 {
     background-color: rgba(220, 53, 69, 0.15) !important;
     border-color: rgba(220, 53, 69, 0.4) !important;
     color: #ffffff;
 }

 .alert-danger.bg-danger.bg-opacity-10 h6 {
     color: #dc3545 !important;
     font-weight: 600;
 }

 .alert-danger.bg-danger.bg-opacity-10 ul li {
     color: inherit;
     line-height: 1.6;
 }

 .alert-danger.bg-danger.bg-opacity-10 ul li strong {
     color: inherit;
     font-weight: 600;
 }

/* íƒ­ ìŠ¤íƒ€ì¼ ê°œì„  */
.nav-tabs .nav-link {
    border: none;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
}

.nav-tabs .nav-link:hover {
    border-bottom-color: #007bff;
    background-color: rgba(0, 123, 255, 0.1);
}

.nav-tabs .nav-link.active {
    border-bottom-color: #007bff;
    background-color: rgba(0, 123, 255, 0.1);
    font-weight: 600;
}

/* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.scenario-stat-card {
    animation: fadeInUp 0.6s ease;
}

.scenario-stat-card:nth-child(2) {
    animation-delay: 0.1s;
}

.scenario-stat-card:nth-child(3) {
    animation-delay: 0.2s;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .scenario-efficiency-circle {
        width: 100px;
        height: 100px;
    }
    
    .efficiency-text {
        font-size: 1.2rem;
    }
    
    .nav-tabs .nav-link {
        font-size: 0.9rem;
        padding: 0.5rem 0.75rem;
    }
}
</style>

<!-- ğŸ”§ JavaScript ê¸°ëŠ¥ -->
<script>
// ê±´ë¬¼ ë°ì´í„°
const buildingData = {
    'B001': {
        name: 'ë³¸ì‚¬ ê±´ë¬¼',
        floors: 5,
        description: 'ë©”ì¸ ì˜¤í”¼ìŠ¤ ê±´ë¬¼ - ì¼ë°˜ ì‚¬ë¬´ì‹¤, íšŒì˜ì‹¤, ë¡œë¹„ í¬í•¨',
        floorData: {
            1: { name: 'ë¡œë¹„', sensors: { temp: 22, hum: 55, occ: 15, power: 45 } },
            2: { name: 'ì‚¬ë¬´ì‹¤', sensors: { temp: 24, hum: 50, occ: 25, power: 78 } },
            3: { name: 'íšŒì˜ì‹¤', sensors: { temp: 23, hum: 52, occ: 8, power: 35 } },
            4: { name: 'ê°œë³„ì‹¤', sensors: { temp: 24, hum: 51, occ: 12, power: 42 } },
            5: { name: 'ê´€ë¦¬ì‹¤', sensors: { temp: 23, hum: 53, occ: 5, power: 28 } }
        }
    },
    'B002': {
        name: 'ì—°êµ¬ì†Œ',
        floors: 3,
        description: 'ì—°êµ¬ê°œë°œ ì „ìš© ì‹œì„¤ - ì‹¤í—˜ì‹¤, í´ë¦°ë£¸, ë¶„ì„ì‹¤ í¬í•¨',
        floorData: {
            1: { name: 'ì¶œì…êµ¬', sensors: { temp: 21, hum: 48, occ: 5, power: 28 } },
            2: { name: 'ì‹¤í—˜ì‹¤', sensors: { temp: 22, hum: 45, occ: 12, power: 65 } },
            3: { name: 'í´ë¦°ë£¸', sensors: { temp: 20, hum: 40, occ: 6, power: 42 } }
        }
    },
    'B003': {
        name: 'ìƒì‚°ê³µì¥',
        floors: 2,
        description: 'ì œì¡° ë° ìƒì‚° ì‹œì„¤ - ìƒì‚°ë¼ì¸, í’ˆì§ˆê´€ë¦¬ì‹¤ í¬í•¨',
        floorData: {
            1: { name: 'ì°½ê³ ', sensors: { temp: 18, hum: 60, occ: 8, power: 55 } },
            2: { name: 'ìƒì‚°ë¼ì¸', sensors: { temp: 25, hum: 55, occ: 18, power: 120 } }
        }
    },
    'B004': {
        name: 'ì°½ê³ ',
        floors: 1,
        description: 'ë¬¼ë¥˜ ë° ë³´ê´€ ì‹œì„¤ - ì¼ë°˜ì°½ê³ , ëƒ‰ì¥ë³´ê´€ì‹¤ í¬í•¨',
        floorData: {
            1: { name: 'ë³´ê´€êµ¬ì—­', sensors: { temp: 16, hum: 65, occ: 3, power: 25 } }
        }
    },
    'B005': {
        name: 'ì‚¬ë¬´ì‹¤',
        floors: 4,
        description: 'ë¶€ì„œë³„ ì‚¬ë¬´ê³µê°„ - ì˜¤í”ˆì˜¤í”¼ìŠ¤, ê°œë³„ì‹¤, íšŒì˜ì‹¤ í¬í•¨',
        floorData: {
            1: { name: 'ì ‘ìˆ˜ì²˜', sensors: { temp: 23, hum: 53, occ: 12, power: 42 } },
            2: { name: 'ì˜¤í”ˆì˜¤í”¼ìŠ¤', sensors: { temp: 24, hum: 51, occ: 35, power: 95 } },
            3: { name: 'íšŒì˜ì‹¤', sensors: { temp: 22, hum: 54, occ: 15, power: 58 } },
            4: { name: 'ê°œë³„ì‹¤', sensors: { temp: 23, hum: 52, occ: 8, power: 38 } }
        }
    }
};

// ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ
function showSmartAlert(message, type = 'info') {
    const alertsDiv = document.getElementById('smart-alerts');
    const contentSpan = document.getElementById('alert-content');
    
    contentSpan.textContent = message;
    alertsDiv.className = `alert alert-${type} border-0 shadow-sm`;
    alertsDiv.style.display = 'block';
    
    // 10ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    setTimeout(() => {
        if (alertsDiv.style.display !== 'none') {
            dismissAlert();
        }
    }, 10000);
}

function dismissAlert() {
    document.getElementById('smart-alerts').style.display = 'none';
}

// ê±´ë¬¼ ì •ë³´ ì—…ë°ì´íŠ¸
function updateBuildingInfo() {
    const buildingId = document.getElementById('building_id').value;
    const floorSelect = document.getElementById('floor_id');
    const infoDiv = document.getElementById('building-info');
    const descSpan = document.getElementById('building-description');
    const sensorDiv = document.getElementById('sensor-summary');
    
    if (buildingId && buildingData[buildingId]) {
        const building = buildingData[buildingId];
        
        // ê±´ë¬¼ ì •ë³´ í‘œì‹œ
        descSpan.textContent = building.description;
        infoDiv.style.display = 'block';
        
        // ì¸µ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
        floorSelect.innerHTML = '<option value="">ì¸µì„ ì„ íƒí•˜ì„¸ìš”</option>';
        for (let i = 1; i <= building.floors; i++) {
            const floorName = building.floorData[i].name;
            floorSelect.innerHTML += `<option value="${i}">${i}ì¸µ - ${floorName}</option>`;
        }
        
        // ì¸µ ì„ íƒ ì´ˆê¸°í™”
        floorSelect.value = '';
        
        // ì„¼ì„œ ë°ì´í„° ìˆ¨ê¸°ê¸° (ì¸µ ì„ íƒ í›„ í‘œì‹œ)
        sensorDiv.style.display = 'none';
        
        // ìë™ìœ¼ë¡œ í˜„ì¬ ì‹œê°„ ì„¤ì •
        const now = new Date();
        document.getElementById('hour').value = now.getHours();
        
        showSmartAlert(`${building.name} ì„ íƒë¨. ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”.`, 'info');
    } else {
        infoDiv.style.display = 'none';
        sensorDiv.style.display = 'none';
        floorSelect.innerHTML = '<option value="">ì¸µì„ ì„ íƒí•˜ì„¸ìš”</option>';
    }
}

// ì¸µ ì •ë³´ ì—…ë°ì´íŠ¸
function updateFloorInfo() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    const sensorDiv = document.getElementById('sensor-summary');
    
    if (buildingId && floorId && buildingData[buildingId] && buildingData[buildingId].floorData[floorId]) {
        const building = buildingData[buildingId];
        const floor = building.floorData[floorId];
        
        // ì„¼ì„œ ë°ì´í„° í‘œì‹œ
        document.getElementById('current-temp').textContent = `${floor.sensors.temp}Â°C`;
        document.getElementById('current-power').textContent = `${floor.sensors.power}kWh`;
        document.getElementById('current-hum').textContent = `${floor.sensors.hum}%`;
        document.getElementById('current-occ').textContent = `${floor.sensors.occ}ëª…`;
        sensorDiv.style.display = 'block';
        
        // ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ í‘œì‹œ
        if (floor.sensors.power > 100) {
            showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name})ì˜ ì „ë ¥ ì‚¬ìš©ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤.`, 'warning');
        } else {
            showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name}) ì„ íƒë¨.`, 'success');
        }
    } else {
        sensorDiv.style.display = 'none';
    }
}

// ìŠ¤ë§ˆíŠ¸ í”„ë¦¬ì…‹ ì„¤ì •
function setSmartPreset(type) {
    const buildingId = document.getElementById('building_id').value;
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    const presets = {
        'office': { hour: 14, temp: 24, hum: 50, occ: 20 },
        'peak': { hour: 18, temp: 26, hum: 60, occ: 10 },
        'night': { hour: 2, temp: 20, hum: 45, occ: 80 },
        'weekend': { hour: 12, temp: 22, hum: 55, occ: 60 }
    };
    
    const preset = presets[type];
    if (preset) {
        document.getElementById('hour').value = preset.hour;
        document.getElementById('temperature').value = preset.temp;
        document.getElementById('humidity').value = preset.hum;
        document.getElementById('occupancy').value = preset.occ;
        
        updateTempValue(preset.temp);
        updateHumValue(preset.hum);
        updateOccValue(preset.occ);
        
        showSmartAlert(`${type === 'office' ? 'ì—…ë¬´ì‹œê°„' : type === 'peak' ? 'í”¼í¬ì‹œê°„' : type === 'night' ? 'ì•¼ê°„ëª¨ë“œ' : 'ì£¼ë§'} í”„ë¦¬ì…‹ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }
}

// í˜„ì¬ ë°ì´í„° ì‚¬ìš©
function useCurrentData() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ë¨¼ì € ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    const building = buildingData[buildingId];
    const floor = building.floorData[floorId];
    
    if (building && floor) {
        document.getElementById('temperature').value = floor.sensors.temp;
        document.getElementById('humidity').value = floor.sensors.hum;
        document.getElementById('occupancy').value = Math.round((floor.sensors.occ / 60) * 100);
        
        updateTempValue(floor.sensors.temp);
        updateHumValue(floor.sensors.hum);
        updateOccValue(Math.round((floor.sensors.occ / 60) * 100));
        
        // í˜„ì¬ ì‹œê°„ ì„¤ì •
        const now = new Date();
        document.getElementById('hour').value = now.getHours();
        
        showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name})ì˜ í˜„ì¬ ì„¼ì„œ ë°ì´í„°ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }
}

// ê°’ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
function updateTempValue(value) {
    document.getElementById('temp-badge').textContent = `${value}Â°C`;
}

function updateHumValue(value) {
    document.getElementById('hum-badge').textContent = `${value}%`;
}

function updateOccValue(value) {
    document.getElementById('occ-badge').textContent = `${value}%`;
}

// ë¹ ë¥¸ ì˜ˆì¸¡
function quickPredict() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ë¨¼ì € ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    // í˜„ì¬ ë°ì´í„°ë¡œ ìë™ ì„¤ì •
    useCurrentData();
    
    // 1ì´ˆ í›„ ì˜ˆì¸¡ ì‹¤í–‰
    setTimeout(() => {
        document.getElementById('prediction-form').dispatchEvent(new Event('submit'));
    }, 1000);
    
    showSmartAlert('ë¹ ë¥¸ ì˜ˆì¸¡ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
}

// ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ
function compareScenarios() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ë¨¼ì € ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    const comparisonDiv = document.getElementById('scenario-comparison');
    comparisonDiv.style.display = comparisonDiv.style.display === 'none' ? 'block' : 'none';
    
    if (comparisonDiv.style.display === 'block') {
        // ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ì—…ë°ì´íŠ¸
        const building = buildingData[buildingId];
        const floor = building.floorData[floorId];
        const currentPower = floor.sensors.power;
        const optimizedPower = Math.round(currentPower * 0.85);
        const savings = currentPower - optimizedPower;
        
        document.getElementById('scenario-current').textContent = `${currentPower} kWh`;
        document.getElementById('scenario-optimized').textContent = `${optimizedPower} kWh`;
        document.getElementById('scenario-savings').textContent = `${savings} kWh`;
        
        showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name}) ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ë¶„ì„ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
    }
}

// ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
function exportReport() {
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    
    if (!buildingId) {
        showSmartAlert('ë¨¼ì € ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ë¨¼ì € ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    // ê°„ë‹¨í•œ ë³´ê³ ì„œ ìƒì„± ì‹œë®¬ë ˆì´ì…˜
    const building = buildingData[buildingId];
    const floor = building.floorData[floorId];
    const reportData = {
        building: building.name,
        floor: `${floorId}ì¸µ - ${floor.name}`,
        timestamp: new Date().toISOString(),
        power: floor.sensors.power,
        efficiency: 75,
        savings: Math.round(floor.sensors.power * 0.15)
    };
    
    // CSV í˜•íƒœë¡œ ë‹¤ìš´ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜
    const csvContent = `ê±´ë¬¼ëª…,ì¸µ,ì‹œê°„,ì „ë ¥ì‚¬ìš©ëŸ‰,íš¨ìœ¨ì„±,ì ˆì•½ê°€ëŠ¥ëŸ‰
${reportData.building},${reportData.floor},${new Date().toLocaleString()},${reportData.power}kWh,${reportData.efficiency}%,${reportData.savings}kWh`;
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `energy_report_${buildingId}_${floorId}F_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showSmartAlert(`${building.name} ${floorId}ì¸µ(${floor.name}) ì—ë„ˆì§€ ë³´ê³ ì„œê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
}

// ì•¡ì…˜ ì‹¤í–‰
function applyAction(actionType) {
    const actions = {
        'temp_down': 'ì˜¨ë„ê°€ 2ë„ ë‚®ì¶°ì¡ŒìŠµë‹ˆë‹¤.',
        'lights_off': 'ë¶ˆí•„ìš”í•œ ì¡°ëª…ì´ êº¼ì¡ŒìŠµë‹ˆë‹¤.',
        'standby_off': 'ëŒ€ê¸°ì „ë ¥ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.'
    };
    
    const button = event.target;
    button.disabled = true;
    button.textContent = 'ì‹¤í–‰ë¨';
    button.classList.remove('btn-success');
    button.classList.add('btn-secondary');
    
    showSmartAlert(actions[actionType], 'success');
}

function applyAllActions() {
    const buttons = document.querySelectorAll('.action-item .btn-success');
    buttons.forEach(button => {
        button.click();
    });
    showSmartAlert('ëª¨ë“  ê¶Œì¥ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
}

// í¼ ì œì¶œ ì²˜ë¦¬
document.getElementById('prediction-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const buildingId = document.getElementById('building_id').value;
    const floorId = document.getElementById('floor_id').value;
    const hour = document.getElementById('hour').value;
    
    if (!buildingId) {
        showSmartAlert('ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!floorId) {
        showSmartAlert('ì¸µì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    if (!hour) {
        showSmartAlert('ì˜ˆì¸¡ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'warning');
        return;
    }
    
    // UI ìƒíƒœ ë³€ê²½
    document.getElementById('loading').style.display = 'block';
    document.getElementById('prediction-result').style.display = 'none';
    document.getElementById('error-message').style.display = 'none';
    document.getElementById('initial-state').style.display = 'none';
    
    // í¼ ë°ì´í„° ìˆ˜ì§‘
    const hourValue = parseInt(hour) || 12;
    const temp = parseFloat(document.getElementById('temperature').value) || 22;
    const hum = parseFloat(document.getElementById('humidity').value) || 50;
    const occ = parseFloat(document.getElementById('occupancy').value) || 30;
    
    // ì‹¤ì œ ì˜ˆì¸¡ API í˜¸ì¶œ
    const predictionData = {
        building_id: buildingId,
        hour: hourValue,
        temperature: temp,
        humidity: hum,
        occupancy: occ
    };
    
    fetch('/api/predict', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(predictionData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('ì˜ˆì¸¡ ê²°ê³¼:', data);
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        // íš¨ìœ¨ì„± ê³„ì‚°
        let efficiency = 85;
        if (data.prediction > 100) efficiency = 60;
        else if (data.prediction > 80) efficiency = 70;
        else if (data.prediction > 60) efficiency = 80;
        
        // ì ˆì•½ëŸ‰ ê³„ì‚°
        const savings = Math.round(data.prediction * 0.15);
        const savingsCost = savings * 150; // kWhë‹¹ 150ì›
        
        // ê²°ê³¼ í‘œì‹œ
        showPredictionResult({
            power: data.prediction,
            efficiency: efficiency,
            savings: savings,
            savingsCost: savingsCost,
            level: data.level,
            color: data.color
        });
        
        // ì‹¤ì‹œê°„ ë¹„ìš© ì—…ë°ì´íŠ¸
        updateCostAnalysis(data.prediction);
        
        // ì„±ê³µ ì•Œë¦¼
        showSmartAlert(`ì˜ˆì¸¡ ì™„ë£Œ! ì˜ˆìƒ ì „ë ¥ ì‚¬ìš©ëŸ‰: ${data.prediction} kWh`, 'success');
    })
    .catch(error => {
        console.error('ì˜ˆì¸¡ ì˜¤ë¥˜:', error);
        
        // ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('error-text').textContent = `ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`;
        
        // ì˜¤ë¥˜ ì•Œë¦¼
        showSmartAlert(`ì˜ˆì¸¡ ì˜¤ë¥˜: ${error.message}`, 'danger');
    });
});

function showPredictionResult(data) {
    // ì „ë ¥ ì‚¬ìš©ëŸ‰ í‘œì‹œ
    document.getElementById('prediction-value').textContent = `${data.power} kWh`;
    
    // ë ˆë²¨ í‘œì‹œ (ì„œë²„ì—ì„œ ë°›ì€ ì •ë³´ ì‚¬ìš©)
    const level = data.level || 'ë³´í†µ';
    const levelClass = data.color || 'warning';
    
    document.getElementById('prediction-level').innerHTML = `<span class="badge bg-${levelClass}">${level}</span>`;
    
    // íš¨ìœ¨ì„± í‘œì‹œ
    document.getElementById('efficiency-bar').style.width = `${data.efficiency}%`;
    document.getElementById('efficiency-bar').textContent = `${data.efficiency}%`;
    document.getElementById('efficiency-percentage').textContent = `${data.efficiency}%`;
    
    // ë“±ê¸‰ ê³„ì‚°
    let grade;
    if (data.efficiency >= 85) grade = 'A+';
    else if (data.efficiency >= 75) grade = 'A';
    else if (data.efficiency >= 65) grade = 'B+';
    else if (data.efficiency >= 55) grade = 'B';
    else grade = 'C';
    
    document.getElementById('efficiency-grade').textContent = grade;
    
    // ì ˆì•½ëŸ‰ í‘œì‹œ
    document.getElementById('savings-power').textContent = `${data.savings} kWh`;
    document.getElementById('savings-cost').textContent = `â‚©${data.savingsCost.toLocaleString()}`;
    
    // ê¶Œì¥ì‚¬í•­ ìƒì„±
    const recommendations = [];
    if (data.power > 80) recommendations.push('ì—ì–´ì»¨ ì„¤ì • ì˜¨ë„ë¥¼ 1-2ë„ ë†’ì—¬ë³´ì„¸ìš”');
    if (data.efficiency < 70) recommendations.push('ë¶ˆí•„ìš”í•œ ì¥ë¹„ì˜ ì „ì›ì„ ì°¨ë‹¨í•˜ì„¸ìš”');
    if (data.power > 100) recommendations.push('í”¼í¬ ì‹œê°„ëŒ€ ì‚¬ìš©ëŸ‰ì„ ë¶„ì‚°ì‹œì¼œë³´ì„¸ìš”');
    recommendations.push('LED ì¡°ëª…ìœ¼ë¡œ êµì²´ë¥¼ ê²€í† í•´ë³´ì„¸ìš”');
    
    const recDiv = document.getElementById('recommendations');
    recDiv.innerHTML = recommendations.map(rec => 
        `<div class="list-group-item d-flex align-items-center">
            <i class="fas fa-check-circle text-success me-2"></i>
            <span>${rec}</span>
        </div>`
    ).join('');
    
    // ê²°ê³¼ í‘œì‹œ
    document.getElementById('loading').style.display = 'none';
    document.getElementById('prediction-result').style.display = 'block';
}

function updateCostAnalysis(predictedPower) {
    const dailyCost = predictedPower * 24 * 150;
    const monthlyCost = dailyCost * 30;
    const savingsToday = dailyCost * 0.15;
    
    document.getElementById('daily-cost').textContent = `â‚©${dailyCost.toLocaleString()}`;
    document.getElementById('monthly-cost').textContent = `â‚©${monthlyCost.toLocaleString()}`;
    document.getElementById('savings-today').textContent = `â‚©${Math.round(savingsToday).toLocaleString()}`;
}

// ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜ë“¤
function createPredictionChart() {
    fetch('/api/prediction/comparison')
        .then(response => response.json())
        .then(data => {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            
            const trace1 = {
                x: data.labels,
                y: data.actual_data,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'ì‹¤ì œ ì‚¬ìš©ëŸ‰',
                line: { color: '#e74c3c', width: 3 },
                marker: { size: 6 }
            };
            
            const trace2 = {
                x: data.labels,
                y: data.predicted_data,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'ì˜ˆì¸¡ ì‚¬ìš©ëŸ‰',
                line: { color: '#3498db', width: 3, dash: 'dash' },
                marker: { size: 6 }
            };
            
            const layout = {
                title: {
                    text: '24ì‹œê°„ ì˜ˆì¸¡ vs ì‹¤ì œ ì „ë ¥ ì‚¬ìš©ëŸ‰ ë¹„êµ',
                    font: { 
                        size: 16,
                        color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50'
                    }
                },
                xaxis: {
                    title: 'ì‹œê°„',
                    gridcolor: currentTheme === 'dark' ? '#404040' : '#e9ecef',
                    color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50'
                },
                yaxis: {
                    title: 'ì „ë ¥ ì‚¬ìš©ëŸ‰ (kWh)',
                    gridcolor: currentTheme === 'dark' ? '#404040' : '#e9ecef',
                    color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50'
                },
                paper_bgcolor: currentTheme === 'dark' ? '#1a1a1a' : '#ffffff',
                plot_bgcolor: currentTheme === 'dark' ? '#2d2d2d' : '#f8f9fa',
                font: { color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50' },
                legend: {
                    x: 0.02,
                    y: 0.98,
                    bgcolor: currentTheme === 'dark' ? '#2d2d2d' : '#ffffff',
                    bordercolor: currentTheme === 'dark' ? '#404040' : '#e9ecef'
                },
                margin: { l: 60, r: 30, t: 60, b: 60 }
            };
            
            Plotly.newPlot('prediction-chart', [trace1, trace2], layout, {responsive: true});
        })
        .catch(error => {
            console.error('ì°¨íŠ¸ ìƒì„± ì˜¤ë¥˜:', error);
        });
}

function createTrendChart() {
    // ì‹œê°„ëŒ€ë³„ ì „ë ¥ ì‚¬ìš©ëŸ‰ íŠ¸ë Œë“œ ë°ì´í„° ìƒì„±
    const hours = Array.from({length: 24}, (_, i) => `${i.toString().padStart(2, '0')}:00`);
    const powerData = hours.map(hour => {
        const h = parseInt(hour.split(':')[0]);
        // ì‹œê°„ëŒ€ë³„ íŒ¨í„´ (ì—…ë¬´ì‹œê°„ì— ë†’ìŒ)
        let base = 20;
        if (h >= 9 && h <= 18) base = 60; // ì—…ë¬´ì‹œê°„
        else if (h >= 19 && h <= 22) base = 40; // ì €ë…ì‹œê°„
        else if (h >= 23 || h <= 6) base = 15; // ì•¼ê°„ì‹œê°„
        
        return Math.round(base + Math.random() * 20);
    });
    
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    
    const trace = {
        x: hours,
        y: powerData,
        type: 'scatter',
        mode: 'lines+markers',
        fill: 'tonexty',
        fillcolor: currentTheme === 'dark' ? 'rgba(52, 152, 219, 0.3)' : 'rgba(52, 152, 219, 0.1)',
        line: { 
            color: currentTheme === 'dark' ? '#5dade2' : '#3498db', 
            width: 3 
        },
        marker: { 
            size: 6,
            color: currentTheme === 'dark' ? '#5dade2' : '#3498db'
        },
        name: 'ì „ë ¥ ì‚¬ìš©ëŸ‰'
    };
    
    const layout = {
        title: {
            text: 'ì‹œê°„ëŒ€ë³„ ì „ë ¥ ì‚¬ìš©ëŸ‰ íŒ¨í„´',
            font: { 
                size: 16,
                color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50'
            }
        },
        xaxis: {
            title: {
                text: 'ì‹œê°„',
                font: { color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50' }
            },
            gridcolor: currentTheme === 'dark' ? '#404040' : '#e9ecef',
            color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50',
            zerolinecolor: currentTheme === 'dark' ? '#404040' : '#e9ecef'
        },
        yaxis: {
            title: {
                text: 'ì „ë ¥ ì‚¬ìš©ëŸ‰ (kWh)',
                font: { color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50' }
            },
            gridcolor: currentTheme === 'dark' ? '#404040' : '#e9ecef',
            color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50',
            zerolinecolor: currentTheme === 'dark' ? '#404040' : '#e9ecef'
        },
        paper_bgcolor: currentTheme === 'dark' ? '#1a1a1a' : '#ffffff',
        plot_bgcolor: currentTheme === 'dark' ? '#2d2d2d' : '#f8f9fa',
        font: { color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50' },
        margin: { l: 60, r: 30, t: 60, b: 60 },
        showlegend: true,
        legend: {
            x: 0.02,
            y: 0.98,
            bgcolor: currentTheme === 'dark' ? '#2d2d2d' : '#ffffff',
            bordercolor: currentTheme === 'dark' ? '#404040' : '#e9ecef',
            font: { color: currentTheme === 'dark' ? '#ffffff' : '#2c3e50' }
        }
    };
    
    // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì™„ì „íˆ ì œê±°í•˜ê³  ìƒˆë¡œ ìƒì„±
    const trendChartDiv = document.getElementById('trend-chart');
    if (trendChartDiv) {
        Plotly.purge('trend-chart');
    }
    
    Plotly.newPlot('trend-chart', [trace], layout, {responsive: true});
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    // í˜„ì¬ ì‹œê°„ ìë™ ì„¤ì •
    const now = new Date();
    document.getElementById('hour').value = now.getHours();
    
    // ê³„ì ˆ ìë™ ì„¤ì •
    const month = now.getMonth() + 1;
    let season;
    if (month >= 3 && month <= 5) season = 'spring';
    else if (month >= 6 && month <= 8) season = 'summer';
    else if (month >= 9 && month <= 11) season = 'autumn';
    else season = 'winter';
    
    document.getElementById('season').value = season;
    
    // í‰ì¼/ì£¼ë§ ìë™ ì„¤ì •
    const dayOfWeek = now.getDay();
    document.getElementById('day_type').value = (dayOfWeek === 0 || dayOfWeek === 6) ? 'weekend' : 'weekday';
    
    // ì°¨íŠ¸ ìƒì„±
    createPredictionChart();
    createTrendChart();
    
    // í™˜ì˜ ë©”ì‹œì§€
    setTimeout(() => {
        showSmartAlert('ìŠ¤ë§ˆíŠ¸ ì „ë ¥ ê´€ë¦¬ ì‹œìŠ¤í…œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ê±´ë¬¼ì„ ì„ íƒí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”.', 'info');
    }, 1000);
});

// ì‹œë‚˜ë¦¬ì˜¤ ì ìš© í•¨ìˆ˜ë“¤
function applyOptimization() {
    showSmartAlert('AI ìµœì í™” ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! HVAC ì˜¨ë„ë¥¼ 24Â°Cë¡œ ì¡°ì •í•˜ê³  ì¡°ëª…ì„ 70%ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.', 'success');
    
    // ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ì„¹ì…˜ í‘œì‹œ
    document.getElementById('scenario-comparison').style.display = 'block';
    
    // ìµœì í™” íƒ­ í™œì„±í™”
    const optimizedTab = new bootstrap.Tab(document.getElementById('optimized-tab'));
    optimizedTab.show();
    
    // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
    setTimeout(() => {
        document.querySelectorAll('.scenario-stat-card').forEach(card => {
            card.style.animation = 'none';
            card.offsetHeight; // ë¦¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
            card.style.animation = 'fadeInUp 0.6s ease';
        });
    }, 100);
}

function applyEcoMode() {
    showSmartAlert('ì—ì½” ëª¨ë“œê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ìµœëŒ€ ì ˆì•½ì„ ìœ„í•´ HVAC ì˜¨ë„ë¥¼ 26Â°Cë¡œ ì¡°ì •í•˜ê³  ì¡°ëª…ì„ 50%ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.', 'warning');
    
    // ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ì„¹ì…˜ í‘œì‹œ
    document.getElementById('scenario-comparison').style.display = 'block';
    
    // ì—ì½” íƒ­ í™œì„±í™”
    const ecoTab = new bootstrap.Tab(document.getElementById('eco-tab'));
    ecoTab.show();
    
    // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
    setTimeout(() => {
        document.querySelectorAll('.scenario-stat-card').forEach(card => {
            card.style.animation = 'none';
            card.offsetHeight; // ë¦¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
            card.style.animation = 'fadeInUp 0.6s ease';
        });
    }, 100);
}

function applyPerformanceMode() {
    showSmartAlert('ì„±ëŠ¥ ëª¨ë“œê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ìµœê³  ì„±ëŠ¥ì„ ìœ„í•´ HVAC ì˜¨ë„ë¥¼ 20Â°Cë¡œ ì¡°ì •í•˜ê³  ì¡°ëª…ì„ 100%ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.', 'danger');
    
    // ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ ì„¹ì…˜ í‘œì‹œ
    document.getElementById('scenario-comparison').style.display = 'block';
    
    // ì„±ëŠ¥ íƒ­ í™œì„±í™”
    const performanceTab = new bootstrap.Tab(document.getElementById('performance-tab'));
    performanceTab.show();
    
    // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
    setTimeout(() => {
        document.querySelectorAll('.scenario-stat-card').forEach(card => {
            card.style.animation = 'none';
            card.offsetHeight; // ë¦¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
            card.style.animation = 'fadeInUp 0.6s ease';
        });
    }, 100);
}

// ì¦‰ì‹œ ì‹¤í–‰ ì•¡ì…˜ í•¨ìˆ˜ë“¤
function applyAction(actionType) {
    const actions = {
        'temp_down': {
            message: 'HVAC ì˜¨ë„ë¥¼ 2ë„ ë‚®ì¶°ì„œ ì¼ì¼ â‚©1,200ì„ ì ˆì•½í–ˆìŠµë‹ˆë‹¤!',
            type: 'success'
        },
        'lights_off': {
            message: 'ë¶ˆí•„ìš”í•œ ì¡°ëª…ì„ ë„ê³  ì¼ì¼ â‚©800ì„ ì ˆì•½í–ˆìŠµë‹ˆë‹¤!',
            type: 'success'
        },
        'standby_off': {
            message: 'ëŒ€ê¸°ì „ë ¥ì„ ì°¨ë‹¨í•˜ì—¬ ì¼ì¼ â‚©500ì„ ì ˆì•½í–ˆìŠµë‹ˆë‹¤!',
            type: 'success'
        }
    };
    
    const action = actions[actionType];
    if (action) {
        showSmartAlert(action.message, action.type);
        
        // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check me-1"></i>ì ìš©ë¨';
        button.classList.remove('btn-success');
        button.classList.add('btn-secondary');
        button.disabled = true;
        
        // 3ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('btn-secondary');
            button.classList.add('btn-success');
            button.disabled = false;
        }, 3000);
    }
}

function applyAllActions() {
    showSmartAlert('ëª¨ë“  ê¶Œì¥ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì¼ì¼ ì´ â‚©2,500ì„ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'success');
    
    // ëª¨ë“  ì•¡ì…˜ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
    document.querySelectorAll('.action-item .btn-success').forEach(button => {
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check me-1"></i>ì ìš©ë¨';
        button.classList.remove('btn-success');
        button.classList.add('btn-secondary');
        button.disabled = true;
        
        // 3ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('btn-secondary');
            button.classList.add('btn-success');
            button.disabled = false;
        }, 3000);
    });
}

// ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ í•¨ìˆ˜
function showSmartAlert(message, type = 'info') {
    // ì•Œë¦¼ ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ìƒì„±
    let alertContainer = document.getElementById('alert-container');
    if (!alertContainer) {
        alertContainer = document.createElement('div');
        alertContainer.id = 'alert-container';
        alertContainer.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; max-width: 400px; max-height: 80vh; overflow-y: auto;';
        document.body.appendChild(alertContainer);
    }
    
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show mb-2`;
    alertDiv.style.cssText = 'min-width: 300px; animation: slideInFromRight 0.3s ease;';
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'danger' ? 'times-circle' : 'info-circle'} me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // ìƒˆë¡œìš´ ì•Œë¦¼ì„ ë§¨ ìœ„ì— ì¶”ê°€
    alertContainer.insertBefore(alertDiv, alertContainer.firstChild);
    
    // ê¸°ì¡´ ì•Œë¦¼ë“¤ì„ ì•„ë˜ë¡œ ë°€ì–´ë‚´ê¸°
    const existingAlerts = alertContainer.querySelectorAll('.alert');
    existingAlerts.forEach((alert, index) => {
        if (index > 0) { // ì²« ë²ˆì§¸ ì•Œë¦¼(ìƒˆë¡œ ì¶”ê°€ëœ ê²ƒ) ì œì™¸
            alert.style.transform = `translateY(${index * 80}px)`;
            alert.style.transition = 'transform 0.3s ease';
        }
    });
    
    // 5ì´ˆ í›„ ìë™ ì œê±°
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.style.animation = 'slideOutToRight 0.3s ease';
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                    // ë‚¨ì€ ì•Œë¦¼ë“¤ì˜ ìœ„ì¹˜ ì¬ì¡°ì •
                    const remainingAlerts = alertContainer.querySelectorAll('.alert');
                    remainingAlerts.forEach((alert, index) => {
                        alert.style.transform = `translateY(${index * 80}px)`;
                    });
                }
            }, 300);
        }
    }, 5000);
    
    // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
    const closeBtn = alertDiv.querySelector('.btn-close');
    closeBtn.addEventListener('click', () => {
        alertDiv.style.animation = 'slideOutToRight 0.3s ease';
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
                // ë‚¨ì€ ì•Œë¦¼ë“¤ì˜ ìœ„ì¹˜ ì¬ì¡°ì •
                const remainingAlerts = alertContainer.querySelectorAll('.alert');
                remainingAlerts.forEach((alert, index) => {
                    alert.style.transform = `translateY(${index * 80}px)`;
                });
            }
        }, 300);
    });
}
</script>

{% endblock %}